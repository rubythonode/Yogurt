global.ADD_STYLE=METHOD({run:function(m,params){"use strict";var dom=params.dom,style=params.style,target=dom.getEl();EACH(style,function(value,name){if(name==="onDisplayResize"){EVENT({name:"resize"},RAR(function(){ADD_STYLE({dom:dom,style:value(WIN_WIDTH(),WIN_HEIGHT())})}))}else{try{if(name==="position"&&value==="fixed"&&INFO.checkIsSupportFixed()!==true){target.style.position="absolute"}else if(name==="flt"){target.style.cssFloat=value}else if(typeof value==="number"&&name!=="zIndex"&&name!=="opacity"){target.style[name]=value+"px"}else if(name==="backgroundHDImage"){target.style.backgroundImage="url("+value+")"}else if(name==="backgroundImage"){target.style[name]="url("+value+")";if(INFO.checkIsSupportHD()===true){HD.addBGSwitch({dom:dom,url:value})}}else{target.style[name]=value;if(INFO.checkIsSupportHD()===true&&name==="background"&&value.length>=7&&value.substring(0,4)==="url("){HD.addBGSwitch({dom:dom,url:value.charAt(4)==="'"||value.charAt(4)==='"'?value.substring(5,value.length-2):value.substring(4,value.length-1)})}if(name==="transform"){target.style.WebkitTransform=value;target.style.MozTransform=value;target.style.OTransform=value;target.style.MsTransform=value}else if(name==="transformOrigin"){target.style.WebkitTransformOrigin=value;target.style.MozTransformOrigin=value;target.style.OTransformOrigin=value;target.style.MsTransformOrigin=value}else if(name==="animation"){target.style.WebkitAnimation=value;target.style.MozAnimation=value;target.style.OAnimation=value;target.style.MsAnimation=value}else if(name==="touchCallout"){target.style.WebkitTouchCallout=value;target.style.MozTouchCallout=value;target.style.OTouchCallout=value;target.style.MsTouchCallout=value}else if(name==="userSelect"){target.style.WebkitUserSelect=value;target.style.MozUserSelect=value;target.style.OUserSelect=value;target.style.MsUserSelect=value}}}catch(e){}}})}});global.ANIMATE=METHOD({run:function(m,params,callback){"use strict";var node=params.node,dom=node.getDom(),keyframes=params.keyframes,duration=params.duration,timingFunction=params.timingFunction===undefined?"":params.timingFunction,delay=params.delay===undefined?"":params.delay,iterationCount=params.iterationCount===undefined?"":params.iterationCount,direction=params.direction===undefined?"":params.direction,playState=params.playState===undefined?"":params.playState,str=keyframes.getName()+" "+(duration===undefined?"":duration+"s")+" "+timingFunction+" "+delay+" "+iterationCount+" "+direction+" "+playState;dom.addStyle({animation:str});if(callback!==undefined&&duration!==undefined){DELAY(duration,function(){callback(node)})}}});global.BROWSER_CONFIG={loadingIndicatorImgUrl:"UPPERCASE/R/loading.gif",isSupportHD:true,isLayerOnCanvas:true,minBrowserVersions:{}};global.CLEAR_BOTH=METHOD({run:function(m){"use strict";return DIV({style:{clear:"both"}})}});global.CLOSE_WIN=METHOD({run:function(m,path){global.open("about:blank","_self").close()}});global.CONN=OBJECT({init:function(cls,inner,self){"use strict";var socket=cls.socket,instantListenerCount=0,enterRoom,exitRoom,getNextInstantListenerCount,getSocket;self.enterRoom=enterRoom=function(name){socket.emit("__ENTER_ROOM",name)};self.exitRoom=exitRoom=function(name){socket.emit("__EXIT_ROOM",name)};self.getNextInstantListenerCount=getNextInstantListenerCount=function(){instantListenerCount+=1;return instantListenerCount-1};self.getSocket=getSocket=function(){return socket}}});global.CONTEXT=CLASS({init:function(cls,inner,self,canvas){"use strict";var nativeContext=canvas.getEl().getContext("2d"),getNativeContext,drawImg,exportImgData,createImgData,putImgData,setScale,rotate,save,restore,clear;inner.getNativeContext=getNativeContext=function(){return nativeContext};self.drawImg=drawImg=function(params){var img=params.img,left=params.left===undefined?0:params.left,top=params.top===undefined?0:params.top,clipLeft=params.clipLeft!==undefined?params.clipLeft:0,clipTop=params.clipTop!==undefined?params.clipTop:0,clipWidth=params.clipWidth,clipHeight=params.clipHeight,width=params.width,height=params.height;if(clipWidth===undefined&&clipHeight===undefined){if(width>0&&height>0){nativeContext.drawImage(img.getEl(),left,top,width,height)}else{nativeContext.drawImage(img.getEl(),left,top)}}else{if(clipWidth===undefined){clipWidth=img.getWidth()}if(clipHeight===undefined){clipHeight=img.getHeight()}nativeContext.drawImage(img.getEl(),clipLeft,clipTop,clipWidth,clipHeight,left,top,width,height)}};self.exportImgData=exportImgData=function(params,callback){var left=params.left===undefined?0:params.left,top=params.top===undefined?0:params.top,width=params.width,height=params.height;callback(nativeContext.getImageData(left,top,width,height))};self.createImgData=createImgData=function(params){var width=params.width,height=params.height;return nativeContext.createImageData(width,height)};self.putImgData=putImgData=function(params){var data=params.data,left=params.left===undefined?0:params.left,top=params.top===undefined?0:params.top;nativeContext.putImageData(data,left,top)};self.setScale=setScale=function(scaleSize){var scaleWidth=scaleSize.scaleWidth,scaleHeight=scaleSize.scaleHeight;nativeContext.scale(scaleWidth,scaleHeight)};self.rotate=rotate=function(params){var centerLeft=params.centerLeft,centerTop=params.centerTop,degree=params.degree;nativeContext.translate(centerLeft,centerTop);nativeContext.rotate(degree*Math.PI/180);nativeContext.translate(-centerLeft,-centerTop)};self.save=save=function(){nativeContext.save()};self.restore=restore=function(){nativeContext.restore()};self.clear=clear=function(){nativeContext.clearRect(0,0,canvas.getWidth(),canvas.getHeight())}}});global.DOM=CLASS({preset:function(){"use strict";return NODE},init:function(cls,inner,self,params){"use strict";var tag=params.tag,children=params.children,style=params.style,text=params.text,on=params.on,el,afterReadyNodes,beforeReadyNodes,parentDom,childDoms=[],originDisplay,afterShowProces=[],afterRemoveProces=[],addAfterShowProc,runAfterShowProc,addAfterRemoveProc,runAfterRemoveProc,getEl,setEl,setAttr,getDom,append,appendTo,prepend,prependTo,after,insertAfter,before,insertBefore,remove,removeAllChildren,getParent,setParent,getChildren,addStyle,getStyle,getWidth,getHeight,getLeft,getTop,hide,show,checkIsShow;if(tag==="body"){el=document.body}else if(tag==="__STRING"){el=document.createTextNode(text)}else{el=document.createElement(tag)}self.addAfterShowProc=addAfterShowProc=function(proc){afterShowProces.push(proc)};self.runAfterShowProc=runAfterShowProc=function(){if(afterReadyNodes!==undefined){EACH(afterReadyNodes,function(node){after(node)})}if(beforeReadyNodes!==undefined){EACH(beforeReadyNodes,function(node){before(node)})}EACH(afterShowProces,function(proc){proc()})};self.addAfterRemoveProc=addAfterRemoveProc=function(proc){afterRemoveProces.push(proc)};self.runAfterRemoveProc=runAfterRemoveProc=function(){EACH(afterRemoveProces,function(proc){proc()})};self.getEl=getEl=function(){return el};inner.setEl=setEl=function(_el){el=_el};inner.setAttr=setAttr=function(params){var name=params.name,value=params.value;el.setAttribute(name,value)};self.getDom=getDom=function(){return self};self.append=append=function(node){var splits;if(CHECK_IS_DATA(node)===true){el.appendChild(node.getDom().getEl());childDoms.push(node.getDom());node.setParent(self);node.getDom().runAfterShowProc()}else{node=String(node);splits=node.split("\n");EACH(splits,function(text,i){append(DOM({tag:"__STRING",text:text}));if(i<splits.length-1){append(BR())}})}};if(children!==undefined){EACH(children,function(child,i){append(child)})}self.appendTo=appendTo=function(node){node.append(self);return self};self.prepend=prepend=function(node){var splits,i;if(CHECK_IS_DATA(node)===true){if(el.childNodes[0]===undefined){el.appendChild(node.getDom().getEl())}else{el.insertBefore(node.getDom().getEl(),el.childNodes[0])}childDoms.push(node.getDom());node.setParent(self);node.getDom().runAfterShowProc()}else{node=String(node);splits=node.split("\n");for(i=splits.length-1;i>=0;i-=1){prepend(DOM({tag:"__STRING",text:splits[i]}));if(i<splits.length-1){prepend(BR())}}}};self.prependTo=prependTo=function(node){node.prepend(self);return self};self.after=after=function(node){var splits,dom,i;if(el.parentNode===TO_DELETE){if(afterReadyNodes===undefined){afterReadyNodes=[]}afterReadyNodes.push(node)}else{if(CHECK_IS_DATA(node)===true){el.parentNode.insertBefore(node.getDom().getEl(),el.nextSibling);parentDom.getChildren().push(node.getDom());node.setParent(parentDom);node.getDom().runAfterShowProc()}else{node=String(node);splits=node.split("\n");for(i=splits.length-1;i>=0;i-=1){dom=DOM({tag:"__STRING",text:node});after(dom);if(i<splits.length-1){dom=BR();after(dom)}}}}};self.insertAfter=insertAfter=function(node){node.after(self);return self};self.before=before=function(node){var splits;if(el.parentNode===TO_DELETE){if(beforeReadyNodes===undefined){beforeReadyNodes=[]}beforeReadyNodes.push(node)}else{if(CHECK_IS_DATA(node)===true){el.parentNode.insertBefore(node.getDom().getEl(),el);parentDom.getChildren().push(node.getDom());node.setParent(parentDom);node.getDom().runAfterShowProc()}else{node=String(node);splits=node.split("\n");EACH(splits,function(text,i){var dom=DOM({tag:"__STRING",text:node});before(dom);if(i<splits.length-1){dom=BR();before(dom)}})}}};self.insertBefore=insertBefore=function(node){node.before(self);return self};self.remove=remove=function(){if(el.parentNode!==TO_DELETE){removeAllChildren();el.parentNode.removeChild(el);REMOVE({data:parentDom.getChildren(),value:self});setParent(undefined);runAfterRemoveProc();el=undefined}};self.removeAllChildren=removeAllChildren=function(){EACH(childDoms,function(child){child.remove()})};self.getParent=getParent=function(){return parentDom};self.setParent=setParent=function(_parentDom){parentDom=_parentDom};self.getChildren=getChildren=function(){return childDoms};self.addStyle=addStyle=function(style){ADD_STYLE({dom:self,style:style})};self.getStyle=getStyle=function(name){var style=el.style[name];return style===""?undefined:style};if(style!==undefined){addStyle(style)}self.getWidth=getWidth=function(){return el.offsetWidth};self.getHeight=getHeight=function(){return el.offsetHeight};self.getLeft=getLeft=function(){var left=0,parent=el;do{left+=parent.offsetLeft-parent.scrollLeft;parent=parent.offsetParent}while(parent!==TO_DELETE);return left+SCROLL_LEFT()};self.getTop=getTop=function(){var top=0,parent=el;do{top+=parent.offsetTop-parent.scrollTop;parent=parent.offsetParent}while(parent!==TO_DELETE);return top+SCROLL_TOP()};self.hide=hide=function(){if(getStyle("display")!=="none"){originDisplay=getStyle("display");addStyle({display:"none"})}};self.show=show=function(){if(originDisplay===undefined){originDisplay="block"}addStyle({display:originDisplay})};self.checkIsShow=checkIsShow=function(){return getStyle("display")!=="none"};if(on!==undefined){EACH(on,function(func,name){EVENT({node:self,name:name},func)})}}});global.E=CLASS({init:function(cls,inner,self,params){"use strict";var e=params.e,el=params.el,isDescendant,stopDefault,stopBubbling,stop,getLeft,getTop,getKeyCode;isDescendant=function(parent,child){var node=child.parentNode;while(node!==TO_DELETE){if(node===parent){return true}node=node.parentNode}return false};self.stopDefault=stopDefault=function(){e.preventDefault()};self.stopBubbling=stopBubbling=function(){e.stopPropagation()};self.stop=stop=function(){stopDefault();stopBubbling()};self.getLeft=getLeft=function(){var touchPageX;if(INFO.checkIsDisplayTouchable()===true){if(e.touches!==undefined&&e.touches[0]!==undefined){EACH(e.touches,function(touch){if(touch.target!==undefined&&isDescendant(el,touch.target)===true){touchPageX=touch.pageX;return false}});if(touchPageX===undefined){touchPageX=e.touches[0].pageX}return touchPageX}if(e.changedTouches!==undefined&&e.changedTouches[0]!==undefined){EACH(e.changedTouches,function(touch){if(touch.target!==undefined&&isDescendant(el,touch.target)===true){touchPageX=touch.pageX;return false}});if(touchPageX===undefined){touchPageX=e.changedTouches[0].pageX}return touchPageX}}return e.pageX};self.getTop=getTop=function(){var touchPageY;if(INFO.checkIsDisplayTouchable()===true){if(e.touches!==undefined&&e.touches[0]!==undefined){EACH(e.touches,function(touch){if(touch.target!==undefined&&isDescendant(el,touch.target)===true){touchPageY=touch.pageY;return false}});if(touchPageY===undefined){touchPageY=e.touches[0].pageY}return touchPageY}if(e.changedTouches!==undefined&&e.changedTouches[0]!==undefined){EACH(e.changedTouches,function(touch){if(touch.target!==undefined&&isDescendant(el,touch.target)===true){touchPageY=touch.pageY;return false}});if(touchPageY===undefined){touchPageY=e.changedTouches[0].pageY}return touchPageY}}return e.pageY};self.getKeyCode=getKeyCode=function(){return e.keyCode}}});global.EVENT=CLASS({init:function(cls,inner,self,params,func){"use strict";var isSupportHD=INFO.checkIsSupportHD(),node=params.node,name=params.name,eventLow1,eventLow2,startLeft,startTop,remove,fire;if(name==="tap"){if(INFO.checkIsDisplayTouchable()===true){eventLow1=EVENT_LOW({node:node,name:"touchstart"},function(e){startLeft=e.getLeft();startTop=e.getTop();e.stopBubbling()});eventLow2=EVENT_LOW({node:node,name:"touchend"},function(e,node){var left=e.getLeft(),top=e.getTop();if(startLeft-10<=left&&left<=startLeft+10&&startTop-10<=top&&top<=startTop+10){return func(e,node)}});self.remove=remove=function(){eventLow1.remove();eventLow2.remove()};self.fire=fire=function(){eventLow1.fire();eventLow2.fire()}}else{eventLow1=EVENT_LOW({node:node,name:"mousedown"},function(e){startLeft=e.getLeft();startTop=e.getTop();e.stopBubbling()});eventLow2=EVENT_LOW({node:node,name:"mouseup"},function(e,node){var left=e.getLeft(),top=e.getTop();if(startLeft-10<=left&&left<=startLeft+10&&startTop-10<=top&&top<=startTop+10){return func(e,node)}});self.remove=remove=function(){eventLow1.remove();eventLow2.remove()};self.fire=fire=function(){eventLow1.fire();eventLow2.fire()}}}else if(name==="touchstart"&&INFO.checkIsDisplayTouchable()!==true){eventLow1=EVENT_LOW({node:node,name:"mousedown"},func);self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}else if(name==="touchmove"&&INFO.checkIsDisplayTouchable()!==true){eventLow1=EVENT_LOW({node:node,name:"mousemove"},func);self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}else if(name==="touchend"&&INFO.checkIsDisplayTouchable()!==true){eventLow1=EVENT_LOW({node:node,name:"mouseup"},func);self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}else if(name==="mouseover"&&INFO.checkIsDisplayTouchable()===true){eventLow1=EVENT_LOW({node:node,name:"touchstart"},func);self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}else if(name==="mouseout"&&INFO.checkIsDisplayTouchable()===true){eventLow1=EVENT_LOW({node:node,name:"touchend"},func);self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}else if(name==="load"&&node.type===IMG){eventLow1=EVENT_LOW({node:node,name:"load"},function(e,img){if(isSupportHD===false||img.checkIsForHDLoad()===true||HD.checkIsProcessedURL(img.getSrc())===false||img.checkIsHD()===true){func(e,img)}});self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}else{eventLow1=EVENT_LOW(params,func);self.remove=remove=function(){eventLow1.remove()};self.fire=fire=function(){eventLow1.fire()}}}});global.EVENT_LOW=CLASS({init:function(cls,inner,self,params,func){"use strict";var node=params.node,name=params.name,el,innerFunc,remove,fire;if(node!==undefined){el=node.getDom().getEl()}else if(global["on"+name]===undefined){el=document}else{el=global}inner.innerFunc=innerFunc=function(e){if(node===undefined){return func(E({e:e,el:el}))}else if(node.getDom().getEl()!==undefined){return func(E({e:e,el:el}),node)}};el.addEventListener(name,innerFunc,false);self.remove=remove=function(){el.removeEventListener(name,innerFunc,false)};self.fire=fire=function(){func(undefined,node)}}});FOR_BOX(function(box){"use strict";box.GO=METHOD({run:function(m,uri){location.href="#"+(box.boxName===CONFIG.defaultBoxName?"":box.boxName+"/")+uri}})});FOR_BOX(function(box){"use strict";box.GO_NEW_WIN=METHOD({run:function(m,uri){global.open("#"+(box.boxName===CONFIG.defaultBoxName?"":box.boxName+"/")+uri)}})});global.HD=OBJECT({init:function(cls,inner,self){"use strict";var isProcessedURLs={},hdImgDatas={},imgSwitches={},bgSwitches={},load,checkIsProcessedURL,applyImg,applyBG,applyHDImg,addImgSwitch,addBGSwitch;self.load=load=function(url){var imgBlankPixelData,isNeedHDProc,hdCanvas,hdContext,hdImgData,hdImageData;if(isProcessedURLs[url]!==true){isProcessedURLs[url]=true;CANVAS().exportImgData({img:IMG({src:url,isForHDLoad:true})},function(imgData){var width=imgData.width,height=imgData.height,data=imgData.data,i,j,idx,idx2;imgBlankPixelData=CHECK_IS_BLANK_PIXEL.imgBlankPixelDatas[url]=[];isNeedHDProc=BROWSER_CONFIG.isSupportHD===true&&INFO.checkIsDisplayHD()===true;if(isNeedHDProc===true){hdCanvas=CANVAS();hdCanvas.setSize({width:width*2,height:height*2});hdContext=hdCanvas.getContext();hdImgData=hdContext.createImgData({width:width*2,height:height*2});hdImageData=hdImgData.data}for(i=0;i<height;i+=1){imgBlankPixelData[i]=[];for(j=0;j<width;j+=1){idx=i*width*4+j*4;imgBlankPixelData[i][j]=data[idx+3]<255/2;if(isNeedHDProc===true){idx2=(i*4*width+j*2)*4;hdImageData[idx2]=data[idx];hdImageData[idx2+1]=data[idx+1];hdImageData[idx2+2]=data[idx+2];hdImageData[idx2+3]=data[idx+3];hdImageData[idx2+4]=data[idx];hdImageData[idx2+5]=data[idx+1];hdImageData[idx2+6]=data[idx+2];hdImageData[idx2+7]=data[idx+3];idx2=((i*2+1)*2*width+j*2)*4;hdImageData[idx2]=data[idx];hdImageData[idx2+1]=data[idx+1];hdImageData[idx2+2]=data[idx+2];hdImageData[idx2+3]=data[idx+3];hdImageData[idx2+4]=data[idx];hdImageData[idx2+5]=data[idx+1];hdImageData[idx2+6]=data[idx+2];hdImageData[idx2+7]=data[idx+3]}}}if(isNeedHDProc===true){hdContext.putImgData({data:hdImgData});HD.applyHDImg({url:url,dataURL:hdCanvas.exportDataURL(),width:width,height:height})}})}};self.checkIsProcessedURL=checkIsProcessedURL=function(url){return isProcessedURLs[url]};applyImg=function(img,imgData){var dataURL=imgData.dataURL,width=img.getWidth(),height=img.getHeight();if(width===undefined||width<=0){width=imgData.width}if(height===undefined||height<=0){height=imgData.height}img.changeToHD({dataURL:dataURL,width:width,height:height})};applyBG=function(dom,imgData){var dataURL=imgData.dataURL,backgroundSize=dom.getStyle("backgroundSize");if(backgroundSize===undefined||backgroundSize==="initial"){backgroundSize=imgData.width+"px "+imgData.height+"px"}dom.addStyle({backgroundImage:imgData.dataURL,backgroundSize:backgroundSize})};self.applyHDImg=applyHDImg=function(params){var url=params.url,dataURL=params.dataURL,width=params.width,height=params.height,imgData;imgData=hdImgDatas[url]={dataURL:dataURL,width:width,height:height};EACH(imgSwitches[url],function(img){applyImg(img,imgData)});EACH(bgSwitches[url],function(dom){applyBG(dom,imgData)})};self.addImgSwitch=addImgSwitch=function(params){var img=params.img,url=params.url;if(hdImgDatas[url]!==undefined){applyImg(img,hdImgDatas[url])}else{if(imgSwitches[url]===undefined){imgSwitches[url]=[]}imgSwitches[url].push(img)}};self.addBGSwitch=addBGSwitch=function(params){var dom=params.dom,url=params.url;if(hdImgDatas[url]!==undefined){applyBG(dom,hdImgDatas[url])}else{if(bgSwitches[url]===undefined){bgSwitches[url]=[]}bgSwitches[url].push(dom)}}}});global.INFO=OBJECT({init:function(cls,inner,self){"use strict";var isSupportFixed,isSupportCanvas,browserInfo,getLang,changeLang,checkIsDisplayHD,checkIsDisplayTouchable,checkIsSupportHD,checkIsSupportFixed,checkIsSupportCanvas,checkIsSlowBrowser,getBrowserInfo;isSupportCanvas=RUN(function(){var canvas=document.createElement("canvas");return canvas.getContext===undefined||canvas.getContext("2d")===undefined})===false;self.getLang=function(){var lang=UPPERCASE.STORE("__INFO").get("lang");if(lang===undefined){lang=navigator.language;if(lang.length>2){lang=lang.substring(0,2)}lang=lang.toLowerCase()}return lang};self.changeLang=changeLang=function(lang){UPPERCASE.STORE("__INFO").save({key:"lang",value:lang});location.reload()};self.checkIsDisplayHD=checkIsDisplayHD=function(){return global.devicePixelRatio!==undefined&&devicePixelRatio>1?true:false};self.checkIsDisplayTouchable=checkIsDisplayTouchable=function(){return global.ontouchstart!==undefined};self.checkIsSupportHD=checkIsSupportHD=function(){return BROWSER_CONFIG.isSupportHD===true&&checkIsDisplayHD()===true};self.checkIsSupportFixed=checkIsSupportFixed=function(){var el;if(isSupportFixed===undefined){el=document.createElement("div");el.style.position="fixed";el.style.top="10px";document.body.appendChild(el);isSupportFixed=el.offsetTop===10;document.body.removeChild(el)}return isSupportFixed};self.checkIsSupportCanvas=checkIsSupportCanvas=function(){return isSupportCanvas};self.checkIsSlowBrowser=checkIsSlowBrowser=function(){return false};self.getBrowserInfo=getBrowserInfo=function(){if(browserInfo===undefined){var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||-1;this.OS=this.searchString(this.dataOS)||"Unknown OS"},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)return data[i].identity}else if(dataProp)return data[i].identity}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();browserInfo={name:BrowserDetect.browser,version:BrowserDetect.version,os:BrowserDetect.OS}}return browserInfo}}});global.KEYFRAMES=CLASS({init:function(cls,inner,self,keyframes){"use strict";var name="__KEYFRAMES_"+self.id,getName,str="",styleEl,rulesStr="";EACH(keyframes,function(style,key){str+=key+"{";EACH(style,function(value,name){if(typeof value==="number"&&name!=="zIndex"&&name!=="opacity"){value=value+"px"}str+=name.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+value+";";if(name==="transform"){str+="-webkit-transform:"+value+";";str+="-moz-transform:"+value+";";str+="-o-transform:"+value+";";str+="-ms-transform:"+value+";"}});str+="}"});rulesStr+="@-webkit-keyframes "+name+"{"+str+"}";rulesStr+="@-moz-keyframes "+name+"{"+str+"}";rulesStr+="@-o-keyframes "+name+"{"+str+"}";rulesStr+="@-ms-keyframes "+name+"{"+str+"}";rulesStr+="@keyframes "+name+"{"+str+"}";styleEl=document.createElement("style");styleEl.type="text/css";styleEl.appendChild(document.createTextNode(rulesStr));document.getElementsByTagName("head")[0].appendChild(styleEl);self.getName=getName=function(){return name}}});FOR_BOX(function(box){"use strict";box.MATCH_VIEW=METHOD({run:function(m,params){var uris=params.uris,target=params.target,view,preParams;EVENT({name:"hashchange"},RAR(function(){var hashURIParts,isNotFound;hashURIParts=location.hash.substring(1).split("/");isNotFound=EACH(uris,function(uri,i){var uriParts=uri.split("/"),params={},isMatched,f;f=function(){var b=EACH(hashURIParts,function(hashURIPart,i){var uriPart=uriParts[i];if(i===0&&box.boxName!==hashURIPart&&BOX.boxes[hashURIPart]!==undefined){isMatched=false;return false}if(uriPart==="**"){isMatched=true;return false}if(uriPart===undefined){return false}if(uriPart.charAt(0)==="{"&&uriPart.charAt(uriPart.length-1)==="}"){params[uriPart.substring(1,uriPart.length-1)]=hashURIPart}else if(uriParts[i]!==hashURIPart&&uriPart!=="*"){return false}if(hashURIParts.length-1===i&&uriParts.length-1>i&&uriParts[uriParts.length-1]!==""){return false}});if(isMatched===undefined){isMatched=b}};if(box.boxName===CONFIG.defaultBoxName){f()}if(isMatched!==true){uriParts.unshift(box.boxName);f()}if(isMatched===true){DELAY(function(){if(view===undefined){view=target();view.onChangeParams(params);preParams=params}else if(CHECK_ARE_SAME_DATAS({data1:preParams,data2:params})!==true){view.onChangeParams(params);preParams=params}});return false}});if(isNotFound===true&&view!==undefined){view.close();view=undefined}}))}})});FOR_BOX(function(box){"use strict";OVERRIDE({origin:box.MODEL,func:function(origin){box.MODEL=CLASS({init:function(cls,inner,self,params){var name=params.name,propertyNamesForNewEvent=params.propertyNamesForNewEvent===undefined?[]:params.propertyNamesForNewEvent,config=params.config,createConfig,getDataConfig,updateConfig,removeConfig,findDataConfig,findDatasConfig,countDatasConfig,checkIsExistsConfig,createValid,updateValid,room=box.ROOM(name),roomForCreate,roomsForCreate={},subRooms=[],subRoomsForCreate=[],subRoomMapForCreate={},create,getData,getDataWatching,update,remove,findData,findDataWatching,findDatas,findDatasWatching,countDatas,checkIsExists,onNew,onNewWatching,closeOnNew,close,getRoom;if(config!==undefined){createConfig=config.create;getDataConfig=config.getData;updateConfig=config.update;removeConfig=config.remove;findDataConfig=config.findData;findDatasConfig=config.findDatas;countDatasConfig=config.countDatas;checkIsExistsConfig=config.checkIsExists;if(createConfig!==undefined){createValid=createConfig.valid}if(updateConfig!==undefined){updateValid=updateConfig.valid}}if(createConfig!==false){self.create=create=function(data,callback){var validResult=createValid.check({data:data});if(validResult.checkHasError()===true){if(callback!==undefined){callback({hasError:true,errors:validResult.getErrors()})}}else{room.send({methodName:"create",data:data},callback)}}}if(getDataConfig!==false){self.getData=getData=function(id,callback){room.send({methodName:"getData",data:id},function(result){var hasError=result.hasError,errors=result.errors,savedData=result.savedData;if(hasError===true||savedData===undefined){callback(result)}else{callback(result)}})};self.getDataWatching=getDataWatching=function(id,callback){room.send({methodName:"getData",data:id},function(result){var hasError=result.hasError,errors=result.errors,savedData=result.savedData,subRoom,closeWatching;if(hasError===true||savedData===undefined){callback(result)}else{subRooms.push(subRoom=box.ROOM(name+"/"+id));callback(result,function(callback){subRoom.on("update",callback)},function(callback){subRoom.on("remove",function(result){callback(result);closeWatching()})},closeWatching=function(){REMOVE({data:subRooms,value:subRoom});subRoom.exit()})}})}}if(updateConfig!==false){self.update=update=function(data,callback){var validResult=updateValid.check({data:data,isExceptUndefined:true}),subRoom;if(validResult.checkHasError()===true){if(callback!==undefined){callback({hasError:true,errors:validResult.getErrors()})}}else{subRoom=box.ROOM(name+"/"+data.id);subRoom.send({methodName:"update",data:data},function(result){if(callback!==undefined){callback(result)}subRoom.exit()})}}}if(removeConfig!==false){self.remove=remove=function(id,callback){var subRoom=box.ROOM(name+"/"+id);subRoom.send({methodName:"remove",data:id},function(result){if(callback!==undefined){callback(result)}subRoom.exit()})}}if(findDataConfig!==false){self.findData=findData=function(params,callback){room.send({methodName:"findData",data:params},function(result){var hasError=result.hasError,errors=result.errors,savedData=result.savedData;if(hasError===true||savedData===undefined){callback(result)}else{callback(result)}})};self.findDataWatching=findDataWatching=function(params,callback){room.send({methodName:"findData",data:params},function(result){var hasError=result.hasError,errors=result.errors,savedData=result.savedData,id=savedData.id,subRoom,closeWatching;if(hasError===true||savedData===undefined){callback(result)}else{subRooms.push(subRoom=box.ROOM(name+"/"+id));callback(result,function(callback){subRoom.on("update",callback)},function(callback){subRoom.on("remove",function(result){callback(result);closeWatching()})},closeWatching=function(){REMOVE({data:subRooms,value:subRoom});subRoom.exit()})}})}}if(findDatasConfig!==false){self.findDatas=findDatas=function(params,callback){room.send({methodName:"findDatas",data:params},function(result){var hasError=result.hasError,errors=result.errors,savedDatas=result.savedDatas;if(hasError===true||savedDatas===undefined){callback(result)}else{callback(result)}})};self.findDatasWatching=findDatasWatching=function(params,callback){room.send({methodName:"findDatas",data:params},function(result){var hasError=result.hasError,errors=result.errors,savedDatas=result.savedDatas,subRooms2={},closeWatching;if(hasError===true||savedDatas===undefined){callback(result)}else{EACH(savedDatas,function(savedData,i){var id=savedData.id;subRooms.push(subRooms2[id]=box.ROOM(name+"/"+id))});callback(result,function(id,callback){subRooms2[id].on("update",callback)},function(id,callback){subRooms2[id].on("remove",function(result){callback(result);closeWatching(id)})},closeWatching=function(id){if(subRooms2[id]!==undefined){REMOVE({data:subRooms,value:subRooms2[id]});subRooms2[id].exit();delete subRooms2[id]}})}})}}if(countDatasConfig!==false){self.countDatas=countDatas=function(filter,callback){room.send({methodName:"countDatas",data:filter},function(result){var hasError=result.hasError,errors=result.errors,savedDatas=result.savedDatas;if(hasError===true||savedDatas===undefined){callback(result)}else{callback(result)}})}}if(checkIsExistsConfig!==false){self.checkIsExists=checkIsExists=function(filter,callback){room.send({methodName:"checkIsExists",data:filter},function(result){var hasError=result.hasError,errors=result.errors,savedDatas=result.savedDatas;if(hasError===true||savedDatas===undefined){callback(result)}else{callback(result)}})}}self.onNew=onNew=function(properties,func){var f=function(savedData){var id=savedData.id;func(savedData)};if(func===undefined){func=properties;if(roomForCreate===undefined){roomForCreate=box.ROOM(name+"/create")}roomForCreate.on("create",f)}else{EACH(properties,function(value,propertyName){var room=roomsForCreate[propertyName+"/"+value];if(room===undefined){room=roomsForCreate[propertyName+"/"+value]=box.ROOM(name+"/"+propertyName+"/"+value+"/create")}room.on("create",f)})}};self.onNewWatching=onNewWatching=function(properties,func){var f=function(savedData,subRoomsForCreate){var id=savedData.id,subRoom,closeWatching;subRooms.push(subRoom=box.ROOM(name+"/"+id));subRoomsForCreate.push(subRoom);func(savedData,function(callback){subRoom.on("update",callback)},function(callback){subRoom.on("remove",function(result){callback(result);
closeWatching()})},closeWatching=function(){subRoom.exit();REMOVE({data:subRooms,value:subRoom})})};if(func===undefined){func=properties;if(roomForCreate===undefined){roomForCreate=box.ROOM(name+"/create")}roomForCreate.on("create",function(savedData){f(savedData,subRoomsForCreate)})}else{EACH(properties,function(value,propertyName){var room=roomsForCreate[propertyName+"/"+value],subRoomsForCreate=subRoomMapForCreate[propertyName+"/"+value];if(room===undefined){room=roomsForCreate[propertyName+"/"+value]=box.ROOM(name+"/"+propertyName+"/"+value+"/create")}if(subRoomsForCreate===undefined){subRoomsForCreate=subRoomMapForCreate[propertyName+"/"+value]=[]}room.on("create",function(savedData){f(savedData,subRoomsForCreate)})})}};self.closeOnNew=closeOnNew=function(properties){if(properties===undefined){if(roomForCreate!==undefined){roomForCreate.exit();roomForCreate=undefined}EACH(subRoomsForCreate,function(subRoom){subRoom.exit();REMOVE({data:subRooms,value:subRoom})});subRoomsForCreate=[]}else{EACH(properties,function(value,propertyName){if(roomsForCreate[propertyName+"/"+value]!==undefined){roomsForCreate[propertyName+"/"+value].exit();delete roomsForCreate[propertyName+"/"+value]}EACH(subRoomMapForCreate[propertyName+"/"+value],function(subRoom){subRoom.exit();REMOVE({data:subRooms,value:subRoom})});delete subRoomMapForCreate[propertyName+"/"+value]})}};self.close=close=function(){if(roomForCreate!==undefined){roomForCreate.exit()}EACH(roomsForCreate,function(room){room.exit()});EACH(subRooms,function(subRoom){subRoom.exit()});room.exit()};inner.getRoom=getRoom=function(){return room}}})}})});global.MSG=METHOD({run:function(m,msgs){"use strict";var msg=msgs[INFO.getLang()];if(msg===undefined){msg=msgs[CONFIG.defaultLang];if(msg===undefined){EACH(msgs,function(_msg){msg=_msg;return false})}}return msg}});global.NODE=CLASS({init:function(cls,inner,self){"use strict";var getDom,append,appendTo,prepend,prependTo,after,insertAfter,before,insertBefore,remove,removeAllChildren,getParent,setParent,getChildren;self.getDom=getDom=function(){};self.append=append=function(node){};self.appendTo=appendTo=function(node){};self.prepend=prepend=function(node){};self.prependTo=prependTo=function(node){};self.after=after=function(node){};self.insertAfter=insertAfter=function(node){};self.before=before=function(node){};self.insertBefore=insertBefore=function(node){};self.remove=remove=function(node){};self.removeAllChildren=removeAllChildren=function(node){};self.getParent=getParent=function(){};self.setParent=setParent=function(parent){};self.getChildren=getChildren=function(){}}});FOR_BOX(function(box){"use strict";box.R=METHOD({run:function(m,path){var url=box.R_URI(path);HD.load(url);return url}})});FOR_BOX(function(box){"use strict";box.RF=METHOD({run:function(m,path){var url=box.RF_URI(path);HD.load(url);return url}})});FOR_BOX(function(box){"use strict";box.RF_URI=METHOD({run:function(m,path){return"/"+box.boxName+"/RF/"+path}})});global.RGBA=METHOD({run:function(m,rgba){"use strict";return"rgba("+rgba[0]+","+rgba[1]+","+rgba[2]+","+rgba[3]+")"}});FOR_BOX(function(box){"use strict";box.ROOM=CLASS({init:function(cls,inner,self,name){var to=CONN.getSocket(),ns=box.boxName+"/"+name,listeners={},isExited,on,send,exit;CONN.enterRoom(ns);self.on=on=function(methodName,_callback){var listenerName=ns+"/"+methodName,callback;callback=function(result){_callback(CHECK_IS_DATA(result)===true?UNPACK_DATA(result):result)};if(listeners[listenerName]===undefined){listeners[listenerName]=[]}listeners[listenerName].push(callback);to.addListener(listenerName,callback);return listenerName};self.send=send=function(params,callback){var methodName=params.methodName,data=params.data,listenerName=ns+"/"+methodName,instantListenerName,dateAttrNames=[];instantListenerName=on("__INSTANT_LISTENER_"+CONN.getNextInstantListenerCount(),function(data){if(callback!==undefined){callback(data)}to.removeAllListeners(instantListenerName);delete listeners[instantListenerName]});to.emit(listenerName,{data:CHECK_IS_DATA(data)===true?PACK_DATA(data):data,instantListenerName:instantListenerName})};self.exit=exit=function(){if(isExited!==true){EACH(listeners,function(callbacks,name){EACH(callbacks,function(callback,i){to.removeListener(name,callback)});delete listeners[name]});CONN.exitRoom(box.boxName+"/"+name);isExited=true}}}})});FOR_BOX(function(box){"use strict";box.R_URI=METHOD({run:function(m,path){return"/"+box.boxName+"/R/"+path+"?"+CONFIG.version}})});global.SCROLL_LEFT=METHOD({run:function(){"use strict";return global.pageXOffset}});global.SCROLL_TOP=METHOD({run:function(){"use strict";return global.pageYOffset}});global.SOUND=CLASS({statics:function(cls){var AudioContext=window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext||window.AudioContext;if(AudioContext!==undefined){cls.audioContext=new AudioContext}},init:function(cls,inner,self,params){var src=params.mp3,ogg=params.ogg,isLoop=params.isLoop,audio=new Audio,request,buffer,source,delayed,play,stop;if(audio.canPlayType("audio/mpeg;")===""&&audio.canPlayType("audio/ogg;")){src=ogg}if(cls.audioContext!==undefined){request=new XMLHttpRequest;request.open("GET",src,true);request.responseType="arraybuffer";request.onload=function(){cls.audioContext.decodeAudioData(request.response,function(_buffer){var gain=cls.audioContext.createGain?cls.audioContext.createGain():cls.audioContext.createGainNode();buffer=_buffer;gain.connect(cls.audioContext.destination);gain.gain.value=.5;if(delayed!==undefined){delayed()}})};request.send();self.play=play=function(){delayed=function(){source=cls.audioContext.createBufferSource();source.buffer=buffer;source.connect(cls.audioContext.destination);source.loop=isLoop;if(source.noteOn!==undefined){source.noteOn(0)}else{source.start(0)}delayed=undefined};if(buffer!==undefined){delayed()}return self};self.stop=stop=function(){if(source!==undefined){if(source.noteOff!==undefined){source.noteOff(0)}else{source.stop(0)}}}}else{audio.src=src;if(isLoop===true){audio.addEventListener("ended",function(){this.currentTime=0;this.play()},false)}self.play=play=function(){audio.play();return self};self.stop=stop=function(){audio.pause()}}}});FOR_BOX(function(box){"use strict";box.STORE=CLASS({init:function(cls,inner,self,name){var genFullKey,save,get,remove;inner.genFullKey=genFullKey=function(key){return box.boxName+"."+name+"."+key};self.save=save=function(params){var key=params.key,fullKey=genFullKey(key),value=params.value,isToSession=params.isToSession;sessionStorage.setItem(fullKey,value);if(isToSession!==true){localStorage.setItem(fullKey,value)}};self.get=get=function(key){var fullKey=genFullKey(key),value;value=sessionStorage.getItem(fullKey);if(value===undefined||value===null){value=localStorage.getItem(fullKey);if(value===null){value=undefined}}return value};self.remove=remove=function(key){var fullKey=genFullKey(key);sessionStorage.removeItem(fullKey);localStorage.removeItem(fullKey)}}})});global.TIME=METHOD({statics:function(m){"use strict";m.diff=0},run:function(m,date){"use strict";return new Date(date.getTime()+m.diff)}});global.TIME_SYNC=OBJECT({init:function(){"use strict";var timeSyncRoom=UPPERCASE.ROOM("timeSync"),now=new Date;timeSyncRoom.send({methodName:"sync",data:{now:now}},function(data){var diff=data.diff;TIME.diff=diff})}});global.TITLE=METHOD({run:function(m,title){"use strict";document.title=title}});global.VIEW=CLASS({init:function(cls,inner,self){"use strict";var onChangeParams,close;self.onChangeParams=onChangeParams=function(params){};self.close=close=function(){}}});global.WIN_HEIGHT=METHOD({run:function(){"use strict";return global.innerHeight}});global.WIN_WIDTH=METHOD({run:function(){"use strict";return global.innerWidth}});global.CHECK_IS_BLANK_PIXEL=METHOD({statics:function(m){"use strict";m.imgBlankPixelDatas={}},run:function(m,params){"use strict";var img=params.img,left=params.left,right=params.right,centerLeft=params.centerLeft,top=params.top,bottom=params.bottom,centerTop=params.centerTop,imgBlankPixelData=m.imgBlankPixelDatas[img.getSrc()],imgBlankPixels;if(imgBlankPixelData!==undefined){if(top!==undefined){imgBlankPixels=imgBlankPixelData[parseInt(top,10)]}else if(bottom!==undefined){imgBlankPixels=imgBlankPixelData[imgBlankPixelData.length-parseInt(bottom,10)-1]}else if(centerTop!==undefined){imgBlankPixels=imgBlankPixelData[parseInt(imgBlankPixelData.length/2,10)+parseInt(centerTop,10)]}if(imgBlankPixels!==undefined){if(left!==undefined){return imgBlankPixels[parseInt(left,10)]}else if(right!==undefined){return imgBlankPixels[imgBlankPixels.length-parseInt(right,10)-1]}else if(centerLeft!==undefined){return imgBlankPixels[parseInt(imgBlankPixels.length/2,10)+parseInt(centerLeft,10)]}}}}});global.A=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"a"}},init:function(cls,inner,self,params){"use strict";var href=params.href,target=params.target,style=params.style,onTap=params.onTap,tapEvent,addTapProc,remove;if(href!==undefined){inner.setAttr({name:"href",value:href})}if(target!==undefined){inner.setAttr({name:"target",value:target})}if(style===undefined||style.cursor===undefined){self.addStyle({cursor:"pointer"})}if(style===undefined||style.textDecoration===undefined){self.addStyle({textDecoration:"underline"})}self.addTapProc=addTapProc=function(func){tapEvent=EVENT({node:self,name:"tap"},func)};if(onTap!==undefined){addTapProc(onTap)}OVERRIDE({origin:self.remove,func:function(origin){self.remove=remove=function(){if(tapEvent!==undefined){tapEvent.remove()}origin()}}})}});global.BODY=OBJECT({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"body"}},init:function(cls,inner,self){"use strict"}});global.BR=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"br"}},init:function(cls,inner,self){"use strict"}});global.CANVAS=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"canvas"}},init:function(cls,inner,self){"use strict";var width,height,getContext,exportImgData,setSize,getWidth,getHeight,exportDataURL;self.getContext=getContext=function(){return CONTEXT(self)};self.exportImgData=exportImgData=function(params,callback){var img=params.img,context=getContext(),evt=EVENT({node:img,name:"load"},function(e){var width=params.width===undefined?img.getWidth():params.width,height=params.height===undefined?img.getHeight():params.height;self.setSize({width:width,height:height});context.drawImg({img:img});context.exportImgData({width:width,height:height},callback);evt.remove()})};self.setSize=setSize=function(size){var el=self.getEl();width=size.width;height=size.height;el.width=width;el.height=height};self.getWidth=getWidth=function(){return width};self.getHeight=getHeight=function(){return height};self.exportDataURL=exportDataURL=function(){return self.getEl().toDataURL()}}});global.DIV=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"div"}},init:function(cls,inner,self){"use strict"}});global.FORM=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"form"}},init:function(cls,inner,self,params){"use strict";var action=params.action,target=params.target,method=params.method,enctype=params.enctype,onSubmit=params.onSubmit,submitProces=[],getData,setData,addSubmitProc,submit;if(action!==undefined){inner.setAttr({name:"action",value:action})}if(target!==undefined){inner.setAttr({name:"target",value:target})}if(method!==undefined){inner.setAttr({name:"method",value:method})}if(enctype!==undefined){inner.setAttr({name:"enctype",value:enctype})}self.getData=getData=function(){var data={},f=function(node){EACH(node.getChildren(),function(child){if(child.getValue!==undefined&&child.getName!==undefined&&child.getName()!==undefined){data[child.getName()]=child.getValue()}f(child)})};f(self);return data};self.setData=setData=function(data){var f=function(node){EACH(node.getChildren(),function(child){var value;if(child.setValue!==undefined&&child.getName!==undefined&&child.getName()!==undefined){value=data[child.getName()];child.setValue(value===undefined?"":value)}f(child)})};f(self)};self.addSubmitProc=addSubmitProc=function(func){submitProces.push(func);EVENT({node:self,name:"submit"},function(e,form){func(e,form);e.stop()})};EVENT({node:self,name:"submit"},function(e){e.stop()});if(onSubmit!==undefined){addSubmitProc(onSubmit)}self.submit=submit=function(isRealSubmit){EACH(submitProces,function(submitProc){submitProc(undefined,self)});if(isRealSubmit===true){self.getEl().submit()}}}});global.H1=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"h1"}},init:function(cls,inner,self){"use strict"}});global.H2=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"h2"}},init:function(cls,inner,self){"use strict"}});global.H3=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"h3"}},init:function(cls,inner,self){"use strict"}});global.H4=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"h4"}},init:function(cls,inner,self){"use strict"}});global.H5=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"h5"}},init:function(cls,inner,self){"use strict"}});global.IFRAME=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"iframe",style:{border:"none"}}},init:function(cls,inner,self,params){"use strict";var name=params.name,src=params.src,setSrc,getSrc;inner.setAttr({name:"allowTransparency",value:true});inner.setAttr({name:"frameBorder",value:0});if(name!==undefined){inner.setAttr({name:"name",value:name})}self.setSrc=setSrc=function(src){inner.setAttr({name:"src",value:src})};if(src!==undefined){setSrc(src)}self.getSrc=getSrc=function(){return src}}});global.IMG=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"img"}},init:function(cls,inner,self,params){"use strict";var src=params.src,isForHDLoad=params.isForHDLoad,el=self.getEl(),isHD,getWidth,getHeight,setSrc,changeToHD,getSrc,checkIsHD,checkIsForHDLoad;self.getWidth=getWidth=function(){return el.width};self.getHeight=getHeight=function(){return el.height};self.setSrc=setSrc=function(src){inner.setAttr({name:"src",value:src});if(BROWSER_CONFIG.isSupportHD===true&&INFO.checkIsDisplayHD!==undefined&&INFO.checkIsDisplayHD()===true){HD.addImgSwitch({img:self,url:src})}};self.changeToHD=changeToHD=function(params){var dataURL=params.dataURL,width=params.width,height=params.height;inner.setAttr({name:"src",value:dataURL});if(self.getStyle("width")===undefined&&self.getStyle("height")===undefined){el.width=width;el.height=height}isHD=true};if(src!==undefined){setSrc(src)}self.getSrc=getSrc=function(){return src};self.checkIsHD=checkIsHD=function(){return isHD};self.checkIsForHDLoad=checkIsForHDLoad=function(){return isForHDLoad}}});global.INPUT=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"input"}},init:function(cls,inner,self,params){"use strict";var name=params.name,type=params.type,placeholder=params.placeholder,value=params.value,isMultiple=params.isMultiple,onChange=params.onChange,changeValueProces=[],getName,getValue,setValue,select,focus,blur,toggleCheck,checkIsChecked,addChangeValueProc;if(type!==undefined){inner.setAttr({name:"type",value:type})}if(type!=="submit"&&type!=="reset"){inner.setAttr({name:"name",value:name});if(placeholder!==undefined){inner.setAttr({name:"placeholder",value:placeholder})}if(isMultiple===true){inner.setAttr({name:"multiple",value:isMultiple})}self.getName=getName=function(){return name};self.getValue=getValue=function(){if(type==="checkbox"){return self.getEl().checked}return self.getEl().value};self.select=select=function(){self.getEl().select()};self.focus=focus=function(){self.getEl().focus()};self.blur=blur=function(){self.getEl().blur()};if(type==="checkbox"){self.toggleCheck=toggleCheck=function(e){if(self.getEl().checked===true){self.getEl().checked=false}else{self.getEl().checked=true}EACH(changeValueProces,function(changeValueProce){changeValueProce(undefined,self)});return self.getEl().checked};self.checkIsChecked=checkIsChecked=function(){return self.getEl().checked};EVENT({node:self,name:"keyup"},function(e){if(e.getKeyCode()===32){DELAY(function(){EACH(changeValueProces,function(changeValueProce){changeValueProce(e,self)})})}})}}self.setValue=setValue=function(value){if(type==="checkbox"){if(value===true){if(self.getEl().checked!==true){self.getEl().checked=true;EACH(changeValueProces,function(changeValueProce){changeValueProce(undefined,self)})}else{self.getEl().checked=true}}else{if(self.getEl().checked===true){self.getEl().checked=false;EACH(changeValueProces,function(changeValueProce){changeValueProce(undefined,self)})}else{self.getEl().checked=false}}}else{if(self.getEl().value!==value){self.getEl().value=value;EACH(changeValueProces,function(changeValueProce){changeValueProce(undefined,self)})}else{self.getEl().value=value}}};if(value!==undefined){setValue(value)}self.addChangeValueProc=addChangeValueProc=function(proc){changeValueProces.push(proc);EVENT({node:self,name:"change"},function(e){proc(e,self)})};if(onChange!==undefined){addChangeValueProc(onChange)}}});global.LI=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"li"}},init:function(cls,inner,self){"use strict"}});global.OPTION=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"option"}},init:function(cls,inner,self,params){"use strict";var value=params.value,getValue,setValue;self.getValue=getValue=function(){return self.getEl().value};self.setValue=setValue=function(value){self.getEl().value=value};if(value===undefined){setValue("")}else{setValue(value)}}});global.P=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"p"}},init:function(cls,inner,self){"use strict"}});global.SELECT=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"select"}},init:function(cls,inner,self,params){"use strict";var name=params.name,value=params.value,onChange=params.onChange,changeValueProces=[],isCtrlDown=false,getName,getValue,setValue,select,focus,blur,addChangeValueProc;inner.setAttr({name:"name",value:name});self.getName=getName=function(){return name};self.getValue=getValue=function(){return self.getEl().value};self.setValue=setValue=function(value){if(self.getEl().value!==value){self.getEl().value=value;EACH(changeValueProces,function(changeValueProce){changeValueProce(undefined,self)})}else{self.getEl().value=value}};if(value!==undefined){setValue(value)}self.select=select=function(){self.getEl().select()};self.focus=focus=function(){self.getEl().focus()};self.blur=blur=function(){self.getEl().blur()};self.addChangeValueProc=addChangeValueProc=function(proc){changeValueProces.push(proc);EVENT({node:self,name:"change"},function(e){proc(e,self)})};if(onChange!==undefined){addChangeValueProc(onChange)}EVENT({node:self,name:"keydown"},function(e){var keyCode=e.getKeyCode();if(keyCode===91||keyCode===17){isCtrlDown=true}else if(isCtrlDown!==true){e.stopBubbling()}});EVENT({node:self,name:"keyup"},function(e){var keyCode=e.getKeyCode();if(keyCode===91||keyCode===17){isCtrlDown=false}})}});global.SPAN=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"span"}},init:function(cls,inner,self){"use strict"}});global.TABLE=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"table"}},init:function(cls,inner,self){"use strict"}});global.TD=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"td"}},init:function(cls,inner,self,params){"use strict";var rowspan=params===undefined?undefined:params.rowspan,colspan=params===undefined?undefined:params.colspan;if(rowspan!==undefined){inner.setAttr({name:"rowspan",value:rowspan})}if(colspan!==undefined){inner.setAttr({name:"colspan",value:colspan})}}});global.TEXTAREA=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"textarea"}},init:function(cls,inner,self,params){"use strict";var name=params.name,placeholder=params.placeholder,value=params.value,onChange=params.onChange,changeValueProces=[],isCtrlDown=false,getName,getValue,setValue,select,focus,blur,addChangeValueProc;inner.setAttr({name:"name",value:name});if(placeholder!==undefined){inner.setAttr({name:"placeholder",value:placeholder})}self.getName=getName=function(){return name};self.getValue=getValue=function(){return self.getEl().value};self.setValue=setValue=function(value){if(self.getEl().value!==value){self.getEl().value=value;EACH(changeValueProces,function(changeValueProce){changeValueProce(undefined,self)})}else{self.getEl().value=value}};if(value!==undefined){setValue(value)}self.select=select=function(){self.getEl().select()};self.focus=focus=function(){self.getEl().focus()};self.blur=blur=function(){self.getEl().blur()};self.addChangeValueProc=addChangeValueProc=function(proc){changeValueProces.push(proc);EVENT({node:self,name:"change"},function(e){proc(e,self)})};if(onChange!==undefined){addChangeValueProc(onChange)}EVENT({node:self,name:"keydown"},function(e){var keyCode=e.getKeyCode();if(keyCode===91||keyCode===17){isCtrlDown=true}else if(isCtrlDown!==true){e.stopBubbling()}});EVENT({node:self,name:"keyup"},function(e){var keyCode=e.getKeyCode();if(keyCode===91||keyCode===17){isCtrlDown=false}})}});global.TH=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"th"}},init:function(cls,inner,self,params){"use strict";var rowspan=params===undefined?undefined:params.rowspan,colspan=params===undefined?undefined:params.colspan;if(rowspan!==undefined){inner.setAttr({name:"rowspan",value:rowspan})}if(colspan!==undefined){inner.setAttr({name:"colspan",value:colspan})}}});global.TR=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"tr"}},init:function(cls,inner,self){"use strict"}});global.UL=CLASS({preset:function(){"use strict";return DOM},params:function(){"use strict";return{tag:"ul"}},init:function(cls,inner,self){"use strict"}});var io="undefined"===typeof module?{}:module.exports;(function(){(function(exports,global){var io=exports;io.version="0.9.10";io.protocol=1;io.transports=[];io.j=[];io.sockets={};io.connect=function(host,details){var uri=io.util.parseUri(host),uuri,socket;if(global&&global.location){uri.protocol=uri.protocol||global.location.protocol.slice(0,-1);uri.host=uri.host||(global.document?global.document.domain:global.location.hostname);uri.port=uri.port||global.location.port}uuri=io.util.uniqueUri(uri);var options={host:uri.host,secure:"https"==uri.protocol,port:uri.port||("https"==uri.protocol?443:80),query:uri.query||""};io.util.merge(options,details);if(options["force new connection"]||!io.sockets[uuri]){socket=new io.Socket(options)}if(!options["force new connection"]&&socket){io.sockets[uuri]=socket}socket=socket||io.sockets[uuri];return socket.of(uri.path.length>1?uri.path:"")}})("object"===typeof module?module.exports:this.io={},this);(function(exports,global){var util=exports.util={};var re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];util.parseUri=function(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri};util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;if("document"in global){host=host||document.domain;port=port||(protocol=="https"&&document.location.protocol!=="https:"?443:document.location.port)}else{host=host||"localhost";if(!port&&protocol=="https"){port=443}}return(protocol||"http")+"://"+host+":"+(port||80)};util.query=function(base,addition){var query=util.chunkQuery(base||""),components=[];util.merge(query,util.chunkQuery(addition||""));for(var part in query){if(query.hasOwnProperty(part)){components.push(part+"="+query[part])}}return components.length?"?"+components.join("&"):""};util.chunkQuery=function(qs){var query={},params=qs.split("&"),i=0,l=params.length,kv;for(;i<l;++i){kv=params[i].split("=");if(kv[0]){query[kv[0]]=kv[1]}}return query};var pageLoaded=false;util.load=function(fn){if("document"in global&&document.readyState==="complete"||pageLoaded){return fn()}util.on(global,"load",fn,false)};util.on=function(element,event,fn,capture){if(element.attachEvent){element.attachEvent("on"+event,fn)}else if(element.addEventListener){element.addEventListener(event,fn,capture)}};util.request=function(xdomain){if(xdomain&&"undefined"!=typeof XDomainRequest){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!xdomain||util.ua.hasCORS)){return new XMLHttpRequest}if(!xdomain){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}return null};if("undefined"!=typeof window){util.load(function(){pageLoaded=true})}util.defer=function(fn){if(!util.ua.webkit||"undefined"!=typeof importScripts){return fn()}util.load(function(){setTimeout(fn,100)})};util.merge=function merge(target,additional,deep,lastseen){var seen=lastseen||[],depth=typeof deep=="undefined"?2:deep,prop;for(prop in additional){if(additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0){if(typeof target[prop]!=="object"||!depth){target[prop]=additional[prop];seen.push(additional[prop])}else{util.merge(target[prop],additional[prop],depth-1,seen)}}}return target};util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype)};util.inherit=function(ctor,ctor2){function f(){}f.prototype=ctor2.prototype;ctor.prototype=new f};util.isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};util.intersect=function(arr,arr2){var ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr;for(var i=0,l=shortest.length;i<l;i++){if(~util.indexOf(longest,shortest[i]))ret.push(shortest[i])}return ret};util.indexOf=function(arr,o,i){for(var j=arr.length,i=i<0?i+j<0?0:i+j:i||0;i<j&&arr[i]!==o;i++){}return j<=i?-1:i};util.toArray=function(enu){var arr=[];for(var i=0,l=enu.length;i<l;i++)arr.push(enu[i]);return arr};util.ua={};util.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(e){return false}return a.withCredentials!=undefined}();util.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);util.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);(function(exports,io){exports.EventEmitter=EventEmitter;function EventEmitter(){}EventEmitter.prototype.on=function(name,fn){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=fn}else if(io.util.isArray(this.$events[name])){this.$events[name].push(fn)}else{this.$events[name]=[this.$events[name],fn]}return this};EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.once=function(name,fn){var self=this;function on(){self.removeListener(name,on);fn.apply(this,arguments)}on.listener=fn;this.on(name,on);return this};EventEmitter.prototype.removeListener=function(name,fn){if(this.$events&&this.$events[name]){var list=this.$events[name];if(io.util.isArray(list)){var pos=-1;for(var i=0,l=list.length;i<l;i++){if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}}if(pos<0){return this}list.splice(pos,1);if(!list.length){delete this.$events[name]}}else if(list===fn||list.listener&&list.listener===fn){delete this.$events[name]}}return this};EventEmitter.prototype.removeAllListeners=function(name){if(name===undefined){this.$events={};return this}if(this.$events&&this.$events[name]){this.$events[name]=null}return this};EventEmitter.prototype.listeners=function(name){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=[]}if(!io.util.isArray(this.$events[name])){this.$events[name]=[this.$events[name]]}return this.$events[name]};EventEmitter.prototype.emit=function(name){if(!this.$events){return false}var handler=this.$events[name];if(!handler){return false}var args=Array.prototype.slice.call(arguments,1);if("function"==typeof handler){handler.apply(this,args)}else if(io.util.isArray(handler)){var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}}else{return false}return true}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,nativeJSON){"use strict";if(nativeJSON&&nativeJSON.parse){return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}}var JSON=exports.JSON={};function f(n){return n<10?"0"+n:n}function date(d,key){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=date(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})};JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}})("undefined"!=typeof io?io:module.exports,typeof JSON!=="undefined"?JSON:undefined);(function(exports,io){var parser=exports.parser={};var packets=parser.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"];var reasons=parser.reasons=["transport not supported","client not handshaken","unauthorized"];var advice=parser.advice=["reconnect"];var JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var type=indexOf(packets,packet.type),id=packet.id||"",endpoint=packet.endpoint||"",ack=packet.ack,data=null;switch(packet.type){case"error":var reason=packet.reason?indexOf(reasons,packet.reason):"",adv=packet.advice?indexOf(advice,packet.advice):"";if(reason!==""||adv!=="")data=reason+(adv!==""?"+"+adv:"");break;case"message":if(packet.data!=="")data=packet.data;break;case"event":var ev={name:packet.name};if(packet.args&&packet.args.length){ev.args=packet.args}data=JSON.stringify(ev);break;case"json":data=JSON.stringify(packet.data);break;case"connect":if(packet.qs)data=packet.qs;break;case"ack":data=packet.ackId+(packet.args&&packet.args.length?"+"+JSON.stringify(packet.args):"");break}var encoded=[type,id+(ack=="data"?"+":""),endpoint];if(data!==null&&data!==undefined)encoded.push(data);return encoded.join(":")};parser.encodePayload=function(packets){var decoded="";if(packets.length==1)return packets[0];for(var i=0,l=packets.length;i<l;i++){var packet=packets[i];decoded+=""+packet.length+""+packets[i]}return decoded};var regexp=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;parser.decodePacket=function(data){var pieces=data.match(regexp);if(!pieces)return{};var id=pieces[2]||"",data=pieces[5]||"",packet={type:packets[pieces[1]],endpoint:pieces[4]||""};if(id){packet.id=id;if(pieces[3])packet.ack="data";else packet.ack=true}switch(packet.type){case"error":var pieces=data.split("+");packet.reason=reasons[pieces[0]]||"";packet.advice=advice[pieces[1]]||"";break;case"message":packet.data=data||"";break;case"event":try{var opts=JSON.parse(data);packet.name=opts.name;packet.args=opts.args}catch(e){}packet.args=packet.args||[];break;case"json":try{packet.data=JSON.parse(data)}catch(e){}break;case"connect":packet.qs=data||"";break;case"ack":var pieces=data.match(/^([0-9]+)(\+)?(.*)/);if(pieces){packet.ackId=pieces[1];packet.args=[];if(pieces[3]){try{packet.args=pieces[3]?JSON.parse(pieces[3]):[]}catch(e){}}}break;case"disconnect":case"heartbeat":break}return packet};parser.decodePayload=function(data){if(data.charAt(0)==""){var ret=[];for(var i=1,length="";i<data.length;i++){if(data.charAt(i)==""){ret.push(parser.decodePacket(data.substr(i+1).substr(0,length)));i+=Number(length)+1;length=""}else{length+=data.charAt(i)}}return ret}else{return[parser.decodePacket(data)]}}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io){exports.Transport=Transport;function Transport(socket,sessid){this.socket=socket;this.sessid=sessid}io.util.mixin(Transport,io.EventEmitter);Transport.prototype.heartbeats=function(){return true};Transport.prototype.onData=function(data){this.clearCloseTimeout();if(this.socket.connected||this.socket.connecting||this.socket.reconnecting){this.setCloseTimeout()}if(data!==""){var msgs=io.parser.decodePayload(data);if(msgs&&msgs.length){for(var i=0,l=msgs.length;i<l;i++){this.onPacket(msgs[i])}}}return this};Transport.prototype.onPacket=function(packet){this.socket.setHeartbeatTimeout();if(packet.type=="heartbeat"){return this.onHeartbeat()}if(packet.type=="connect"&&packet.endpoint==""){this.onConnect()}if(packet.type=="error"&&packet.advice=="reconnect"){this.isOpen=false}this.socket.onPacket(packet);return this};Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect()},this.socket.closeTimeout)}};Transport.prototype.onDisconnect=function(){if(this.isOpen)this.close();this.clearTimeouts();this.socket.onDisconnect();return this};Transport.prototype.onConnect=function(){this.socket.onConnect();return this};Transport.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null}};Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout();if(this.reopenTimeout){clearTimeout(this.reopenTimeout)}};Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet))};Transport.prototype.onHeartbeat=function(heartbeat){this.packet({type:"heartbeat"})};Transport.prototype.onOpen=function(){this.isOpen=true;this.clearCloseTimeout();this.socket.onOpen()};Transport.prototype.onClose=function(){var self=this;this.isOpen=false;this.socket.onClose();this.onDisconnect()};Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+"://"+options.host+":"+options.port+"/"+options.resource+"/"+io.protocol+"/"+this.name+"/"+this.sessid};Transport.prototype.ready=function(socket,fn){fn.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports.Socket=Socket;function Socket(options){this.options={port:80,secure:false,document:"document"in global?document:false,resource:"socket.io",transports:io.transports,"connect timeout":1e4,"try multiple transports":true,reconnect:true,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":false,"auto connect":true,"flash policy port":10843,manualFlush:false};io.util.merge(this.options,options);this.connected=false;this.open=false;this.connecting=false;this.reconnecting=false;this.namespaces={};this.buffer=[];this.doBuffer=false;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(global,"beforeunload",function(){self.disconnectSync()},false)}if(this.options["auto connect"]){this.connect()}}io.util.mixin(Socket,io.EventEmitter);Socket.prototype.of=function(name){if(!this.namespaces[name]){this.namespaces[name]=new io.SocketNamespace(this,name);if(name!==""){this.namespaces[name].packet({type:"connect"})}}return this.namespaces[name]};Socket.prototype.publish=function(){this.emit.apply(this,arguments);var nsp;for(var i in this.namespaces){if(this.namespaces.hasOwnProperty(i)){nsp=this.of(i);nsp.$emit.apply(nsp,arguments)}}};function empty(){}Socket.prototype.handshake=function(fn){var self=this,options=this.options;function complete(data){if(data instanceof Error){self.connecting=false;self.onError(data.message)}else{fn.apply(null,data.split(":"))}}var url=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,io.protocol,io.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!io.util.ua.hasCORS){var insertAt=document.getElementsByTagName("script")[0],script=document.createElement("script");script.src=url+"&jsonp="+io.j.length;insertAt.parentNode.insertBefore(script,insertAt);io.j.push(function(data){complete(data);script.parentNode.removeChild(script)})}else{var xhr=io.util.request();xhr.open("GET",url,true);if(this.isXDomain()){xhr.withCredentials=true}xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;if(xhr.status==200){complete(xhr.responseText)}else if(xhr.status==403){self.onError(xhr.responseText)}else{self.connecting=false;!self.reconnecting&&self.onError(xhr.responseText)}}};xhr.send(null)}};Socket.prototype.getTransport=function(override){var transports=override||this.transports,match;for(var i=0,transport;transport=transports[i];i++){if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck(this))){return new io.Transport[transport](this,this.sessionid)}}return null};Socket.prototype.connect=function(fn){if(this.connecting){return this}var self=this;self.connecting=true;this.handshake(function(sid,heartbeat,close,transports){self.sessionid=sid;self.closeTimeout=close*1e3;self.heartbeatTimeout=heartbeat*1e3;if(!self.transports)self.transports=self.origTransports=transports?io.util.intersect(transports.split(","),self.options.transports):self.options.transports;self.setHeartbeatTimeout();function connect(transports){if(self.transport)self.transport.clearTimeouts();self.transport=self.getTransport(transports);if(!self.transport)return self.publish("connect_failed");self.transport.ready(self,function(){self.connecting=true;self.publish("connecting",self.transport.name);self.transport.open();if(self.options["connect timeout"]){self.connectTimeoutTimer=setTimeout(function(){if(!self.connected){self.connecting=false;if(self.options["try multiple transports"]){var remaining=self.transports;while(remaining.length>0&&remaining.splice(0,1)[0]!=self.transport.name){}if(remaining.length){connect(remaining)}else{self.publish("connect_failed")}}}},self.options["connect timeout"])}})}connect(self.transports);self.once("connect",function(){clearTimeout(self.connectTimeoutTimer);fn&&typeof fn=="function"&&fn()})});return this};Socket.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var self=this;this.heartbeatTimeoutTimer=setTimeout(function(){self.transport.onClose()},this.heartbeatTimeout)};Socket.prototype.packet=function(data){if(this.connected&&!this.doBuffer){this.transport.packet(data)}else{this.buffer.push(data)}return this};Socket.prototype.setBuffer=function(v){this.doBuffer=v;if(!v&&this.connected&&this.buffer.length){if(!this.options["manualFlush"]){this.flushBuffer()}}};Socket.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};Socket.prototype.disconnect=function(){if(this.connected||this.connecting){if(this.open){this.of("").packet({type:"disconnect"})}this.onDisconnect("booted")}return this};Socket.prototype.disconnectSync=function(){var xhr=io.util.request();var uri=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,io.protocol,"",this.sessionid].join("/")+"/?disconnect=1";xhr.open("GET",uri,false);xhr.send(null);this.onDisconnect("booted")};Socket.prototype.isXDomain=function(){var port=global.location.port||("https:"==global.location.protocol?443:80);return this.options.host!==global.location.hostname||this.options.port!=port};Socket.prototype.onConnect=function(){if(!this.connected){this.connected=true;this.connecting=false;if(!this.doBuffer){this.setBuffer(false)}this.emit("connect")}};Socket.prototype.onOpen=function(){this.open=true};Socket.prototype.onClose=function(){this.open=false;clearTimeout(this.heartbeatTimeoutTimer)};Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet)};Socket.prototype.onError=function(err){if(err&&err.advice){if(err.advice==="reconnect"&&(this.connected||this.connecting)){this.disconnect();if(this.options.reconnect){this.reconnect()}}}this.publish("error",err&&err.reason?err.reason:err)};Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected,wasConnecting=this.connecting;this.connected=false;this.connecting=false;this.open=false;if(wasConnected||wasConnecting){this.transport.close();this.transport.clearTimeouts();if(wasConnected){this.publish("disconnect",reason);if("booted"!=reason&&this.options.reconnect&&!this.reconnecting){this.reconnect()}}}};Socket.prototype.reconnect=function(){this.reconnecting=true;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var self=this,maxAttempts=this.options["max reconnection attempts"],tryMultiple=this.options["try multiple transports"],limit=this.options["reconnection limit"];function reset(){if(self.connected){for(var i in self.namespaces){if(self.namespaces.hasOwnProperty(i)&&""!==i){self.namespaces[i].packet({type:"connect"})}}self.publish("reconnect",self.transport.name,self.reconnectionAttempts)}clearTimeout(self.reconnectionTimer);self.removeListener("connect_failed",maybeReconnect);self.removeListener("connect",maybeReconnect);self.reconnecting=false;delete self.reconnectionAttempts;delete self.reconnectionDelay;delete self.reconnectionTimer;delete self.redoTransports;self.options["try multiple transports"]=tryMultiple}function maybeReconnect(){if(!self.reconnecting){return}if(self.connected){return reset()}if(self.connecting&&self.reconnecting){return self.reconnectionTimer=setTimeout(maybeReconnect,1e3)}if(self.reconnectionAttempts++>=maxAttempts){if(!self.redoTransports){self.on("connect_failed",maybeReconnect);self.options["try multiple transports"]=true;self.transports=self.origTransports;self.transport=self.getTransport();self.redoTransports=true;self.connect()}else{self.publish("reconnect_failed");reset()}}else{if(self.reconnectionDelay<limit){self.reconnectionDelay*=2}self.connect();self.publish("reconnecting",self.reconnectionDelay,self.reconnectionAttempts);self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay)}}this.options["try multiple transports"]=false;this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay);this.on("connect",maybeReconnect)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.SocketNamespace=SocketNamespace;function SocketNamespace(socket,name){this.socket=socket;this.name=name||"";this.flags={};this.json=new Flag(this,"json");this.ackPackets=0;this.acks={}}io.util.mixin(SocketNamespace,io.EventEmitter);SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit;SocketNamespace.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};SocketNamespace.prototype.packet=function(packet){packet.endpoint=this.name;this.socket.packet(packet);this.flags={};return this};SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?"json":"message",data:data};if("function"==typeof fn){packet.id=++this.ackPackets;packet.ack=true;this.acks[packet.id]=fn}return this.packet(packet)};SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:"event",name:name};if("function"==typeof lastArg){packet.id=++this.ackPackets;packet.ack="data";this.acks[packet.id]=lastArg;args=args.slice(0,args.length-1)}packet.args=args;return this.packet(packet)};SocketNamespace.prototype.disconnect=function(){if(this.name===""){this.socket.disconnect()}else{this.packet({type:"disconnect"});this.$emit("disconnect")}return this};SocketNamespace.prototype.onPacket=function(packet){var self=this;function ack(){self.packet({type:"ack",args:io.util.toArray(arguments),ackId:packet.id})}switch(packet.type){case"connect":this.$emit("connect");break;case"disconnect":if(this.name===""){this.socket.onDisconnect(packet.reason||"booted")}else{this.$emit("disconnect",packet.reason)}break;case"message":case"json":var params=["message",packet.data];if(packet.ack=="data"){params.push(ack)}else if(packet.ack){this.packet({type:"ack",ackId:packet.id})}this.$emit.apply(this,params);break;case"event":var params=[packet.name].concat(packet.args);if(packet.ack=="data")params.push(ack);this.$emit.apply(this,params);break;case"ack":if(this.acks[packet.ackId]){this.acks[packet.ackId].apply(this,packet.args);delete this.acks[packet.ackId]}break;case"error":if(packet.advice){this.socket.onError(packet)}else{if(packet.reason=="unauthorized"){this.$emit("connect_failed",packet.reason)}else{this.$emit("error",packet.reason)}}break}};function Flag(nsp,name){this.namespace=nsp;this.name=name}Flag.prototype.send=function(){this.namespace.flags[this.name]=true;this.namespace.send.apply(this.namespace,arguments)};Flag.prototype.emit=function(){this.namespace.flags[this.name]=true;this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports.websocket=WS;function WS(socket){io.Transport.apply(this,arguments)}io.util.inherit(WS,io.Transport);WS.prototype.name="websocket";WS.prototype.open=function(){var query=io.util.query(this.socket.options.query),self=this,Socket;if(!Socket){Socket=global.MozWebSocket||global.WebSocket}this.websocket=new Socket(this.prepareUrl()+query);this.websocket.onopen=function(){self.onOpen();self.socket.setBuffer(false)};this.websocket.onmessage=function(ev){self.onData(ev.data)};this.websocket.onclose=function(){self.onClose();self.socket.setBuffer(true)};this.websocket.onerror=function(e){self.onError(e)};return this};if(io.util.ua.iDevice){WS.prototype.send=function(data){var self=this;setTimeout(function(){self.websocket.send(data)},0);return this}}else{WS.prototype.send=function(data){this.websocket.send(data);return this}}WS.prototype.payload=function(arr){for(var i=0,l=arr.length;i<l;i++){this.packet(arr[i])}return this};WS.prototype.close=function(){this.websocket.close();return this};WS.prototype.onError=function(e){this.socket.onError(e)};WS.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};WS.check=function(){return"WebSocket"in global&&!("__addTask"in WebSocket)||"MozWebSocket"in global};WS.xdomainCheck=function(){return true};io.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.flashsocket=Flashsocket;function Flashsocket(){io.Transport.websocket.apply(this,arguments)}io.util.inherit(Flashsocket,io.Transport.websocket);Flashsocket.prototype.name="flashsocket";Flashsocket.prototype.open=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.open.apply(self,args)});return this};Flashsocket.prototype.send=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(self,args)});return this};Flashsocket.prototype.close=function(){WebSocket.__tasks.length=0;io.Transport.websocket.prototype.close.call(this);return this};Flashsocket.prototype.ready=function(socket,fn){function init(){var options=socket.options,port=options["flash policy port"],path=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,"static/flashsocket","WebSocketMain"+(socket.isXDomain()?"Insecure":"")+".swf"];if(!Flashsocket.loaded){if(typeof WEB_SOCKET_SWF_LOCATION==="undefined"){WEB_SOCKET_SWF_LOCATION=path.join("/")}if(port!==843){WebSocket.loadFlashPolicyFile("xmlsocket://"+options.host+":"+port)}WebSocket.__initialize();Flashsocket.loaded=true}fn.call(self)}var self=this;if(document.body)return init();io.util.load(init)};Flashsocket.check=function(){if(typeof WebSocket=="undefined"||!("__initialize"in WebSocket)||!swfobject)return false;return swfobject.getFlashPlayerVersion().major>=10};Flashsocket.xdomainCheck=function(){return true};if(typeof window!="undefined"){WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true}io.transports.push("flashsocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window){var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O[["Active"].concat("Object").join("X")]!=D){try{var ad=new(window[["Active"].concat("Object").join("X")])(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if(typeof j.readyState!=D&&j.readyState=="complete"||typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body)){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||!/%$/.test(aa.width)&&parseInt(aa.width,10)<310){aa.width="310"}if(typeof aa.height==D||!/%$/.test(aa.height)&&parseInt(aa.height,10)<137){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?["Active"].concat("").join("X"):"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return Y[0]>X[0]||Y[0]==X[0]&&Y[1]>X[1]||Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=ad&&typeof ad=="string"?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring(Y[X].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}()}(function(){if("undefined"==typeof window||window.WebSocket)return;var console=window.console;if(!console||!console.log||!console.error){console={log:function(){},error:function(){}}}if(!swfobject.hasFlashPlayerVersion("10.0.0")){console.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){console.error("WARNING: web-socket-js doesn't work in file:///... URL "+"unless you set Flash Security Settings properly. "+"Open the page via Web server i.e. http://...")}WebSocket=function(url,protocols,proxyHost,proxyPort,headers){var self=this;self.__id=WebSocket.__nextId++;WebSocket.__instances[self.__id]=self;self.readyState=WebSocket.CONNECTING;self.bufferedAmount=0;self.__events={};if(!protocols){protocols=[]}else if(typeof protocols=="string"){protocols=[protocols]}setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(self.__id,url,protocols,proxyHost||null,proxyPort||0,headers||null)})},0)};WebSocket.prototype.send=function(data){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var result=WebSocket.__flash.send(this.__id,encodeURIComponent(data));if(result<0){return true}else{this.bufferedAmount+=result;return false}};WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(type,listener,useCapture){if(!(type in this.__events)){this.__events[type]=[]}this.__events[type].push(listener)};WebSocket.prototype.removeEventListener=function(type,listener,useCapture){if(!(type in this.__events))return;var events=this.__events[type];for(var i=events.length-1;i>=0;--i){if(events[i]===listener){events.splice(i,1);break}}};WebSocket.prototype.dispatchEvent=function(event){var events=this.__events[event.type]||[];for(var i=0;i<events.length;++i){events[i](event)}var handler=this["on"+event.type];if(handler)handler(event)};WebSocket.prototype.__handleEvent=function(flashEvent){if("readyState"in flashEvent){this.readyState=flashEvent.readyState}if("protocol"in flashEvent){this.protocol=flashEvent.protocol}var jsEvent;if(flashEvent.type=="open"||flashEvent.type=="error"){jsEvent=this.__createSimpleEvent(flashEvent.type)}else if(flashEvent.type=="close"){jsEvent=this.__createSimpleEvent("close")}else if(flashEvent.type=="message"){var data=decodeURIComponent(flashEvent.message);jsEvent=this.__createMessageEvent("message",data)}else{throw"unknown event type: "+flashEvent.type}this.dispatchEvent(jsEvent)
};WebSocket.prototype.__createSimpleEvent=function(type){if(document.createEvent&&window.Event){var event=document.createEvent("Event");event.initEvent(type,false,false);return event}else{return{type:type,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(type,data){if(document.createEvent&&window.MessageEvent&&!window.opera){var event=document.createEvent("MessageEvent");event.initMessageEvent("message",false,false,data,null,null,window,null);return event}else{return{type:type,data:data,bubbles:false,cancelable:false}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(url){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(url)})};WebSocket.__initialize=function(){if(WebSocket.__flash)return;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){console.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var container=document.createElement("div");container.id="webSocketContainer";container.style.position="absolute";if(WebSocket.__isFlashLite()){container.style.left="0px";container.style.top="0px"}else{container.style.left="-100px";container.style.top="-100px"}var holder=document.createElement("div");holder.id="webSocketFlash";container.appendChild(holder);document.body.appendChild(container);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(e){if(!e.success){console.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i){WebSocket.__tasks[i]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var events=WebSocket.__flash.receiveEvents();for(var i=0;i<events.length;++i){WebSocket.__instances[events[i].webSocketId].__handleEvent(events[i])}}catch(e){console.error(e)}},0);return true};WebSocket.__log=function(message){console.log(decodeURIComponent(message))};WebSocket.__error=function(message){console.error(decodeURIComponent(message))};WebSocket.__addTask=function(task){if(WebSocket.__flash){task()}else{WebSocket.__tasks.push(task)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var mimeType=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!mimeType||!mimeType.enabledPlugin||!mimeType.enabledPlugin.filename){return false}return mimeType.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){if(window.addEventListener){window.addEventListener("load",function(){WebSocket.__initialize()},false)}else{window.attachEvent("onload",function(){WebSocket.__initialize()})}}})();(function(exports,io,global){exports.XHR=XHR;function XHR(socket){if(!socket)return;io.Transport.apply(this,arguments);this.sendBuffer=[]}io.util.inherit(XHR,io.Transport);XHR.prototype.open=function(){this.socket.setBuffer(false);this.onOpen();this.get();this.setCloseTimeout();return this};XHR.prototype.payload=function(payload){var msgs=[];for(var i=0,l=payload.length;i<l;i++){msgs.push(io.parser.encodePacket(payload[i]))}this.send(io.parser.encodePayload(msgs))};XHR.prototype.send=function(data){this.post(data);return this};function empty(){}XHR.prototype.post=function(data){var self=this;this.socket.setBuffer(true);function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;self.posting=false;if(this.status==200){self.socket.setBuffer(false)}else{self.onClose()}}}function onload(){this.onload=empty;self.socket.setBuffer(false)}this.sendXHR=this.request("POST");if(global.XDomainRequest&&this.sendXHR instanceof XDomainRequest){this.sendXHR.onload=this.sendXHR.onerror=onload}else{this.sendXHR.onreadystatechange=stateChange}this.sendXHR.send(data)};XHR.prototype.close=function(){this.onClose();return this};XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain()),query=io.util.query(this.socket.options.query,"t="+ +new Date);req.open(method||"GET",this.prepareUrl()+query,true);if(method=="POST"){try{if(req.setRequestHeader){req.setRequestHeader("Content-type","text/plain;charset=UTF-8")}else{req.contentType="text/plain"}}catch(e){}}return req};XHR.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};XHR.check=function(socket,xdomain){try{var request=io.util.request(xdomain),usesXDomReq=global.XDomainRequest&&request instanceof XDomainRequest,socketProtocol=socket&&socket.options&&socket.options.secure?"https:":"http:",isXProtocol=socketProtocol!=global.location.protocol;if(request&&!(usesXDomReq&&isXProtocol)){return true}}catch(e){}return false};XHR.xdomainCheck=function(socket){return XHR.check(socket,true)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.htmlfile=HTMLFile;function HTMLFile(socket){io.Transport.XHR.apply(this,arguments)}io.util.inherit(HTMLFile,io.Transport.XHR);HTMLFile.prototype.name="htmlfile";HTMLFile.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var iframeC=this.doc.createElement("div");iframeC.className="socketio";this.doc.body.appendChild(iframeC);this.iframe=this.doc.createElement("iframe");iframeC.appendChild(this.iframe);var self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+query;io.util.on(window,"unload",function(){self.destroy()})};HTMLFile.prototype._=function(data,doc){this.onData(data);try{var script=doc.getElementsByTagName("script")[0];script.parentNode.removeChild(script)}catch(e){}};HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};HTMLFile.prototype.close=function(){this.destroy();return io.Transport.XHR.prototype.close.call(this)};HTMLFile.check=function(socket){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window){try{var a=new(window[["Active"].concat("Object").join("X")])("htmlfile");return a&&io.Transport.XHR.check(socket)}catch(e){}}return false};HTMLFile.xdomainCheck=function(){return false};io.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports["xhr-polling"]=XHRPolling;function XHRPolling(){io.Transport.XHR.apply(this,arguments)}io.util.inherit(XHRPolling,io.Transport.XHR);io.util.merge(XHRPolling,io.Transport.XHR);XHRPolling.prototype.name="xhr-polling";XHRPolling.prototype.heartbeats=function(){return false};XHRPolling.prototype.open=function(){var self=this;io.Transport.XHR.prototype.open.call(self);return false};function empty(){}XHRPolling.prototype.get=function(){if(!this.isOpen)return;var self=this;function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;if(this.status==200){self.onData(this.responseText);self.get()}else{self.onClose()}}}function onload(){this.onload=empty;this.onerror=empty;self.onData(this.responseText);self.get()}function onerror(){self.onClose()}this.xhr=this.request();if(global.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=onload;this.xhr.onerror=onerror}else{this.xhr.onreadystatechange=stateChange}this.xhr.send(null)};XHRPolling.prototype.onClose=function(){io.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=empty;try{this.xhr.abort()}catch(e){}this.xhr=null}};XHRPolling.prototype.ready=function(socket,fn){var self=this;io.util.defer(function(){fn.call(self)})};io.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io,global){var indicator=global.document&&"MozAppearance"in global.document.documentElement.style;exports["jsonp-polling"]=JSONPPolling;function JSONPPolling(socket){io.Transport["xhr-polling"].apply(this,arguments);this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg)})}io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]);JSONPPolling.prototype.name="jsonp-polling";JSONPPolling.prototype.post=function(data){var self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="socketio_iframe_"+this.index,iframe;form.className="socketio";form.style.position="absolute";form.style.top="0px";form.style.left="0px";form.style.display="none";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.prepareUrl()+query;function complete(){initIframe();self.socket.setBuffer(false)}function initIframe(){if(self.iframe){self.form.removeChild(self.iframe)}try{iframe=document.createElement('<iframe name="'+self.iframeId+'">')}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();this.area.value=io.JSON.stringify(data);try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}this.socket.setBuffer(true)};JSONPPolling.prototype.get=function(){var self=this,script=document.createElement("script"),query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.prepareUrl()+query;script.onerror=function(){self.onClose()};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;if(indicator){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype._=function(msg){this.onData(msg);if(this.isOpen){this.get()}return this};JSONPPolling.prototype.ready=function(socket,fn){var self=this;if(!indicator)return fn.call(this);io.util.load(function(){fn.call(self)})};JSONPPolling.check=function(){return"document"in global};JSONPPolling.xdomainCheck=function(){return true};io.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this)})();