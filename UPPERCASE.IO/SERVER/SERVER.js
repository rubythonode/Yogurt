global.CONNS=CONNS=OBJECT({init:function(e,o,t){"use strict";var r,a,n,i=e.socketPack,d={};t.addRoomFunc=r=function(e,o){void 0===d[e]&&(d[e]=[]),d[e].push(o)},i.on("connection",function(e){var o,t=e.handshake.headers["x-forwarded-for"],r={},a={},n={},i={};void 0===t&&(t=e.handshake.address.address),e.addListener("disconnect",function(){EACH(i,function(e){EACH(e,function(e){e()})})}),e.addListener("__ENTER_ROOM",function(c){EACH(d,function(d,s){var v,u="",f=s,m={};return v=function(e){var o,t;return-1!==f.indexOf("{")&&-1!==f.indexOf("}")&&(t=f.substring(0,f.indexOf("{")),u+"/"===t)?(o=f.substring(f.indexOf("{")+1,f.indexOf("}")),f=t+e+f.substring(f.indexOf("}")+1),{name:o,value:e}):void 0},EACH(c.split("/"),function(e,o){var t=v(e);return void 0!==t&&(m[t.name]=t.value),0===o?u=e:u+="/"+e,u===f?!1:void 0}),c===f?(void 0===a[c]?(r[c]=[],i[c]=[],e.join(c),EACH(d,function(a){r[c].push(a(c,e,t,e.handshake.headers,m,function(e){o=e},function(){return o},function(){o=void 0},n,i[c]))}),a[c]=1):a[c]+=1,!1):void 0})}),e.addListener("__EXIT_ROOM",function(o){a[o]-=1,0===a[o]&&(EACH(r[o],function(e){e.removeAllListeners()}),e.leave(o),delete r[o],delete a[o],delete i[o])})}),t.emitToAllSockets=a=function(e){var o=e.ns,t=e.listenerName,r=e.data;CONNS.type.socketPack["in"](o).emit(t,r)},t.emitToAllWorkers=n=function(o){a(o),e.broadcastToAllWorkers({methodName:"emitToAllSockets",data:o})}}}),FOR_BOX(function(e){"use strict";OVERRIDE(e.MODEL,function(){e.MODEL=CLASS({init:function(o,t,r,a){var n,i,d,c,s,v,u,f,m,E,O,h,R,C,A,l,N,b,p,M,S=a.name,g=void 0===a.propertyNamesForNewEvent?[]:a.propertyNamesForNewEvent,_=a.config,k=e.DB(S);void 0!==_&&(n=_.create,i=_.get,d=_.update,c=_.remove,s=_.find,v=_.count,u=_.checkIsExists,void 0!==n&&(f=n.valid),void 0!==d&&(m=d.valid)),t.getCreateValid=E=function(){return f},t.getUpdateValid=O=function(){return m},e.ROOM(S+"/create"),EACH(g,function(o){e.ROOM(S+"/"+o+"/{value}/create")}),e.ROOM(S+"/remove"),EACH(g,function(o){e.ROOM(S+"/"+o+"/{value}/remove")}),e.ROOM(S,function(o){n!==!1&&o.on("create",function(r,a){var n,i=void 0===f?void 0:f.check({data:r});void 0!==i&&i.checkHasError()===!0?a({hasError:!0,errors:i.getErrors()}):(n=function(){k.create(r,function(r,n){void 0!==r?a({hasError:!0,errorMsg:r}):(void 0!==t.afterCreate&&t.afterCreate(n),void 0!==t.afterCreateRoom&&t.afterCreateRoom({savedData:n,room:o}),e.ROOMS(S+"/create").broadcast({methodName:"create",data:n}),EACH(g,function(o){var t=n[o];e.ROOMS(S+"/"+o+"/"+t+"/create").broadcast({methodName:"create",data:n})}),a({hasError:!1,savedData:n}))})},void 0===t.beforeCreateRoom?void 0!==t.beforeCreate?t.beforeCreate(r,{ret:a,proc:n})!==!1&&n():n():t.beforeCreateRoom({data:r,room:o},{ret:a,proc:n}))}),i!==!1&&o.on("get",C),s!==!1&&o.on("find",function(e,o){delete e.isFindAll,N(e,o)}),v!==!1&&o.on("count",b),u!==!1&&o.on("checkIsExists",p)}),e.ROOM(S+"/{id}",function(o,r){var a=r.id;d!==!1&&o.on("update",function(e,r){var n,i=void 0===m?void 0:m.check({data:e,isExceptUndefined:!0});e.id=a,void 0!==i&&i.checkHasError()===!0?r({hasError:!0,errors:i.getErrors()}):(n=function(){k.update(e,function(e,a){void 0!==e?r({hasError:!0,errorMsg:e}):(void 0!==a&&(void 0!==t.afterUpdate&&t.afterUpdate(a),void 0!==t.afterUpdateRoom&&t.afterUpdateRoom({savedData:a,room:o}),o.broadcast({methodName:"update",data:a})),r({hasError:!1,savedData:a}))})},void 0===t.beforeUpdateRoom?void 0!==t.beforeUpdate?t.beforeUpdate(e,{ret:r,proc:n})!==!1&&n():n():t.beforeUpdateRoom({data:e,room:o},{ret:r,proc:n})!==!1&&n())}),c!==!1&&o.on("remove",function(r,a){var n;n=function(){k.remove(r,function(r,n){void 0!==r?a({hasError:!0,errorMsg:r}):(void 0!==n&&(void 0!==t.afterRemove&&t.afterRemove(n),void 0!==t.afterRemoveRoom&&t.afterRemoveRoom({savedData:n,room:o}),o.broadcast({methodName:"remove",data:n}),EACH(g,function(o){var t=n[o];e.ROOMS(S+"/"+o+"/"+t+"/remove").broadcast({methodName:"remove",data:n})})),a({hasError:!1,savedData:n}))})},void 0===t.beforeRemoveRoom?void 0!==t.beforeRemove?t.beforeRemove(r,{ret:a,proc:n})!==!1&&n():n():t.beforeRemoveRoom({id:r,room:o},{ret:a,proc:n})!==!1&&n()})}),t.getDB=h=function(){return k},n!==!1&&(r.create=R=function(o,r){var a,n=void 0===f?void 0:f.check({data:o});void 0!==n&&n.checkHasError()===!0?void 0!==r&&r({hasError:!0,errors:n.getErrors()}):(a=function(){k.create(o,function(o,a){void 0!==o?void 0!==r&&r({hasError:!0,errorMsg:o}):(void 0!==t.afterCreate&&t.afterCreate(a),e.ROOMS(S+"/create").broadcast({methodName:"create",data:a}),EACH(g,function(o){var t=a[o];e.ROOMS(S+"/"+o+"/"+t+"/create").broadcast({methodName:"create",data:a})}),void 0!==r&&r({hasError:!1,savedData:a}))})},void 0!==t.beforeCreate?t.beforeCreate(o,{ret:r,proc:a})!==!1&&a():a())}),i!==!1&&(r.get=C=function(e,o){k.get(e,function(e,r){void 0!==e?void 0!==o&&o({hasError:!0,errorMsg:e}):(void 0===t.get||t.get(r,o)!==!1)&&void 0!==o&&o({hasError:!1,savedData:r})})}),d!==!1&&(r.update=A=function(o,r){var a,n=void 0===m?void 0:m.check({data:o,isExceptUndefined:!0});void 0!==n&&n.checkHasError()===!0?void 0!==r&&r({hasError:!0,errors:n.getErrors()}):(a=function(){k.update(o,function(a,n){void 0!==a?void 0!==r&&r({hasError:!0,errorMsg:a}):(void 0!==n&&(void 0!==t.afterUpdate&&t.afterUpdate(n),e.ROOMS(S+"/"+o.id).broadcast({methodName:"update",data:n})),void 0!==r&&r({hasError:!1,savedData:n}))})},void 0!==t.beforeUpdate?t.beforeUpdate(o,{ret:r,proc:a})!==!1&&a():a())}),c!==!1&&(r.remove=l=function(o,r){var a;a=function(){k.remove(o,function(o,a){void 0!==o?void 0!==r&&r({hasError:!0,errorMsg:o}):(void 0!==a&&(void 0!==t.afterRemove&&t.afterRemove(a),e.ROOMS(S+"/"+a.id).broadcast({methodName:"remove",data:a}),EACH(g,function(o){var t=a[o];e.ROOMS(S+"/"+o+"/"+t+"/remove").broadcast({methodName:"remove",data:a})})),void 0!==r&&r({hasError:!1,savedData:a}))})},void 0!==t.beforeRemove?t.beforeRemove(o,{ret:r,proc:a})!==!1&&a():a()}),s!==!1&&(r.find=N=function(e,o){void 0!==e&&void 0===o&&(o=e,e=void 0),k.find(e,function(e,r){void 0!==e?void 0!==o&&o({hasError:!0,errorMsg:e}):(void 0===t.find||t.find(r,o)!==!1)&&void 0!==o&&o({hasError:!1,savedDataSet:r})})}),v!==!1&&(r.count=b=function(e,o){void 0!==e&&void 0===o&&(o=e,e=void 0),k.count(e,function(e,r){void 0!==e?void 0!==o&&o({hasError:!0,errorMsg:e}):(void 0===t.count||t.count(r,o)!==!1)&&void 0!==o&&o({hasError:!1,count:r})})}),u!==!1&&(r.checkIsExists=p=function(e,o){void 0!==e&&void 0===o&&(o=e,e=void 0),k.checkIsExists(e,function(e,r){void 0!==e?void 0!==o&&o({hasError:!0,errorMsg:e}):(void 0===t.checkIsExists||t.checkIsExists(r,o)!==!1)&&void 0!==o&&o({hasError:!1,isExists:r})})}),t.getName=M=function(){return S}}})})}),FOR_BOX(function(e){"use strict";e.MODULE=METHOD({run:function(o,t){var r=__dirname+"/../..";return require(r+"/"+e.boxName+"/SERVER/node_modules/"+t)}})}),FOR_BOX(function(e){"use strict";e.ROOM=METHOD({run:function(o,t,r){CONNS.addRoomFunc(e.boxName+"/"+t,function(e,o,t,a,n,i,d,c,s,v){var u=OBJECT({init:function(r,n,u){var f,m,E,O,h,R,C,A,l,N,b,p,M,S,g={};u.on=f=function(t,r){var a,n=e+"/"+t;a=function(e){var t=CHECK_IS_DATA(e.data)===!0?UNPACK_DATA(e.data):e.data,a=e.instantListenerName;r(t,function(e){o.emit(a,CHECK_IS_DATA(e)===!0?PACK_DATA(e):e)})},o.addListener(n,a),void 0===g[n]&&(g[n]=[]),g[n].push(a)},u.broadcast=m=function(o){var t=o.methodName,r=CHECK_IS_DATA(o.data)===!0?PACK_DATA(o.data):o.data,a=e+"/"+t;CONNS.emitToAllWorkers({fullURI:e,listenerName:a,data:r})},u.broadcastExceptSender=E=function(t){var r=t.methodName,a=CHECK_IS_DATA(t.data)===!0?PACK_DATA(t.data):t.data,n=e+"/"+r;o.broadcast.to(e).emit(n,a),CONNS.type.broadcastToAllWorkers({methodName:"emitToAllSockets",data:{fullURI:e,listenerName:n,data:a}})},u.removeAllListeners=O=function(){EACH(g,function(e,t){EACH(e,function(e){o.removeListener(t,e)})}),g.length=0},u.setAuthKey=h=function(e){i(e)},u.getAuthKey=R=function(){return d()},u.removeAuthKey=C=function(){c()},u.addRole=A=function(e){s[e]=!0},u.checkRole=l=function(e){return s[e]===!0},u.removeRole=N=function(e){REMOVE_AT({data:s,key:e})},u.removeAllRoles=b=function(){EACH(s,function(e,o){REMOVE_AT({data:s,key:o})})},u.addDisconnectListener=p=function(e){v.push(e)},u.getIp=M=function(){return t},u.getHeaders=S=function(){return a}}});return void 0!==r&&r(u,n),u})}})}),FOR_BOX(function(e){"use strict";e.ROOMS=CLASS({init:function(o,t,r,a){var n,i=e.boxName+"/"+a;r.broadcast=n=function(e){var o=e.methodName,t=CHECK_IS_DATA(e.data)===!0?PACK_DATA(e.data):e.data,r=i+"/"+o;CONNS.type.socketPack["in"](i).emit(r,t)}}})}),global.SERVER_CONFIG=SERVER_CONFIG={dbName:"UPPERCASE_IO-testdb",dbUsername:"test",dbPassword:"test",isNotRequiringDBAuth:!1,maxDataCount:1e3,securedUsername:"test",securedPassword:"test"},global.TIME_SYNC=TIME_SYNC=OBJECT({init:function(){"use strict";UPPERCASE.IO.ROOM("timeSync",function(e){e.on("sync",function(e,o){var t=new Date,r=e.now;o({diff:r-t})})})}});