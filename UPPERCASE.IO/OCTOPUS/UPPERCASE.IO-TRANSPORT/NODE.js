global.CONNECT_TO_MAIL_SERVER=CONNECT_TO_MAIL_SERVER=METHOD({run:function(o,e){"use strict";var E=require("nodemailer"),n=o.host,r=o.port,t=o.isSecure,i=o.username,R=o.password,c=E.createTransport("SMTP",{host:n,port:r,secureConnection:t,auth:{user:i,pass:R}});e(function(o){var e=o.senderName,E=o.senderAddress,n=o.receiverAddress,r=o.receiverAddresses,t=o.title,i=o.content;c.sendMail({from:e+" <"+E+">",to:void 0===r?n:RUN(function(){var o="";return EACH(r,function(e,E){o+=e+(E<r.length-1?", ":"")}),o}),subject:t,text:i},function(o){o!==TO_DELETE&&console.log("[UPPERCASE.IO-CONNECT_TO_MAIL_SERVER] SEND MAIL ERROR:",o)})})}}),global.CONNECT_TO_WEB_SOCKET_SERVER=CONNECT_TO_WEB_SOCKET_SERVER=METHOD({run:function(o,e){"use strict";var E,n,r,t,i,R,c=require("ws"),_=void 0===o.host?"localhost":_,s=o.port,S={};CHECK_IS_DATA(e)!==!0?E=e:(E=e.success,n=e.error),R=function(o,e){var E=S[o];void 0!==E&&EACH(E,function(o){o(e,function(){REMOVE({data:E,value:o})})})},r=new c("ws://"+_+":"+s),r.on("open",function(){t=!0,E(function(o,e){var E=S[o];void 0===E&&(E=S[o]=[]),E.push(e)},function(o){r.send(STRINGIFY(o))},function(){i=!0,r.close()})}),r.on("message",function(o){var e=PARSE_STR(o);void 0!==e&&R(e.methodName,e.data)}),r.on("close",function(){i!==!0&&R("__DISCONNECTED")}),r.on("error",function(o){t!==!0?(console.log("[UPPERCASE.IO-CONNECT_TO_WEB_SOCKET_SERVER] CONNECT TO WEB SOCKET SERVER FAILED:",o),void 0!==n&&n(o)):R("__ERROR",o)})}}),global.MULTI_PROTOCOL_SOCKET_SERVER=MULTI_PROTOCOL_SOCKET_SERVER=METHOD({run:function(o,e){"use strict";var E=o.socketServerPort,n=o.webSocketServerPort,r=o.webSocketFixServerPort;SOCKET_SERVER(E,e),WEB_SOCKET_SERVER({port:n,fixServerPort:r},e)}}),global.WEB_SOCKET_FIX_SERVER=WEB_SOCKET_FIX_SERVER=METHOD({run:function(o){"use strict";var e={},E={},n=function(o){void 0!==E[o]&&(E[o].remove(),delete E[o])};WEB_SERVER(o,function(o,r,t){var i,R,c,_,s=o.cookies.__SENDER_KEY;void 0===s&&(s=RANDOM_STR(40)),void 0!==e[s]&&e[s](),n(s),R=function(){void 0!==i&&(i.remove(),i=void 0),delete e[s]},c=function(){R(),void 0!==E[s]&&(E[s].remove(),delete E[s])},_=e[s]=function(o){r({content:STRINGIFY(void 0===o?{senderKey:s}:COMBINE_DATA({origin:{senderKey:s},extend:o})),headers:{"Access-Control-Allow-Origin":"*"}}),R(),E[s]=DELAY(5,c)},t(c),i=DELAY(30,function(){_()})}),console.log("[UPPERCASE.IO-WEB_SOCKET_FIX_SERVER] RUNNING WEB SOCKET FIX SERVER... (PORT:"+o+")")}}),global.WEB_SOCKET_SERVER=WEB_SOCKET_SERVER=METHOD({run:function(o,e){"use strict";var E,n,r,t=require("ws").Server;CHECK_IS_DATA(o)===!0?(E=o.port,n=o.fixServerPort):E=o,r=new t({port:E}),r.on("connection",function(o){var E,n,r={},t=function(o,e){var E=r[o];void 0!==E&&EACH(E,function(o){o(e,function(){REMOVE({data:E,value:o})})})};o.on("message",function(o){var e=PARSE_STR(o);void 0!==e&&t(e.methodName,e.data)}),o.on("close",function(){n!==!0&&t("__DISCONNECTED")}),o.on("error",function(o){t("__ERROR",o)}),E=o.upgradeReq.headers["x-forwarded-for"],void 0===E&&(E=o.upgradeReq.connection.remoteAddress),e({ip:E},function(o,e){var E=r[o];void 0===E&&(E=r[o]=[]),E.push(e)},function(e){o.send(STRINGIFY(e))},function(){n=!0,o.close()})}),console.log("[UPPERCASE.IO-WEB_SOCKET_SERVER] RUNNING WEB SOCKET SERVER... (PORT:"+E+")"),void 0!==n&&WEB_SOCKET_FIX_SERVER(n,e)}});